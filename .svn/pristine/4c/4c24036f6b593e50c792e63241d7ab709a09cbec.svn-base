!function(t){Global.formatImgSrc=function(t){if(!t)return"http://h5.quxiu.me/assets/img/cart_img_black_640x253.png";var e=t.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return e?"http"+e[1]+".jpg":t};var e={init:function(){var t=new lib.httpurl(location.href),e=t.params,i=e.title?decodeURIComponent(e.title):"买二送一活动";document.title=i,this.page=1,new ctrl.topBar({isIndex:!1,title:i}),lib.lazyload.init();var n=this;this.infiniteScroll=lib.infiniteScroll.init({bufferPx:150,time:200,onNear:function(){n.render()},end:function(){return n.isEnd}}),this.render(),new lib.goTop},addEvents:function(){t(".save-btn").on("click",function(){lib.storage.set("addressSelectedId",t(".active").closest(".address-container").attr("data-id")),window.location.href="order-confirm.html"})},addEventsSelect:function(){var e=this;t(".address-container").on("click",function(){if(e.is_select)t(this).find(".active").length||(t(".active").remove(),t(this).append('<span class="active"></span>'));else{var i=t(this).index();lib.storage.set("editAddressData",e.addressData[i]),window.location.href="address-add.html?title=编辑地址"}})},render:function(){var t=this;t.isAjax||(t.isAjax=!0,lib.api.get({api:{c:"deal",a:"goodslist"},data:{brandGroupId:1293,categoryId:0,brandId:1293,is_sort:7,is_have:0,count:20,page:t.page},success:function(e){console.log(e),Array.isArray(e.products)?(t.renderItems(e.products),t.checkNeedScroll()&&!t.infiniteScroll.started&&t.infiniteScroll.start()):1==t.page?t.renderError("empty"):t.isEnd=!0,lib.snow({minSize:5,maxSize:20,newOn:100,stopTime:15e3}),t.page++},error:function(){t.renderError("network")},complete:function(){t.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(e){var i=t("#goods"),n=t("#tpl-items").html();i.append(_.template(n)({data:e})),lib.lazyload.trigger()},renderError:function(t){switch(t){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(e){var i=t(".info-tip");i.html(e).show()}};t(function(){e.init()})}(Zepto,window.Global||(window.Global={}));