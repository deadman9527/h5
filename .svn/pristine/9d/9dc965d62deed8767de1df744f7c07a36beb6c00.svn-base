!function(n,e){var t,r,o=n.MutationObserver||n.WebKitMutationObserver;if(o){var u=[],i=new o(function(){var n=u.slice();u=[],n.forEach(function(n){n[0].call(n[1])})}),c=document.createElement("div");i.observe(c,{attributes:!0}),window.addEventListener("unload",function(){i.disconnect(),i=null}),t=function(n,e){u.push([n,e]),c.setAttribute("drainQueue","drainQueue")}}else t=function(n,e){setTimeout(function(){n.call(e)},1)};var f=function(n,e,t,r){return{enumerable:!!e,configurable:!0,writable:!0,value:n||function(){}}},l=function(n){return f(n,0,1,0)},a=function(n){return f(n,1)},s=function(n){if(void 0===n)return!1;try{var e=n.then;if("function"==typeof e)return!0}catch(t){}return!1},p=function(n){Error.call(this,n)};p.prototype=Object.create(Error.prototype);var v=function(){var n=[];return n.pump=function(e){t(function(){for(var t=n.length,r=0;t>r;)r++,n.shift()(e)})},n},h=function(n,e,r,o,u,i){var c=!1,f=this,l=function(n){t(function(){i("fulfilled"),o(n),e.pump(n)})},a=function(n){t(function(){i("rejected"),u(n),r.pump(n)})},p=function(n){return s(n)?void n.then(p,a):void l(n)},v=function(n){return function(e){c?"undefined"!=typeof console&&console.error("Cannot resolve a Promise multiple times."):(c=!0,n(e))}};this.resolve=v(p,"resolve"),this.fulfill=v(l,"fulfill"),this.reject=v(a,"reject"),this.cancel=function(){f.reject(new Error("Cancel"))},this.timeout=function(){f.reject(new Error("Timeout"))},i("pending")},r=function(n){var e,t,r=new v,o=new v,u="pending";Object.defineProperties(this,{_addAcceptCallback:l(function(n){r.push(n),"fulfilled"==u&&r.pump(e)}),_addRejectCallback:l(function(n){o.push(n),"rejected"==u&&o.pump(t)})});var i=new h(this,r,o,function(n){e=n},function(n){t=n},function(n){u=n});try{n&&n(i)}catch(c){i.reject(c),console.log(c)}},d=function(n){return"function"==typeof n},m=function(n,e,t){if(!d(n)){var r=e[t];e[t]=function(){r.apply(e,arguments)}}return function(){try{var t=n.apply(null,arguments);e.resolve(t)}catch(r){e.reject(r),console.log(r)}}},w=function(n,e,t){return d(n)&&t._addAcceptCallback(n),d(e)&&t._addRejectCallback(e),t};r.prototype=Object.create(null,{then:a(function(n,e){var t=this;return new r(function(r){w(m(n,r,"resolve"),m(e,r,"reject"),t)})}),"catch":a(function(n){var e=this;return new r(function(t){w(null,m(n,t,"reject"),e)})})}),r.isThenable=s;var j=function(n){return Array.prototype.slice.call(n).map(r.resolve)};r.any=function(){var n=j(arguments);return new r(function(e){if(n.length){var t=!1,r=function(n){t||(t=!0,e.resolve(n))},o=function(n){t||(t=!0,e.reject(n))};n.forEach(function(n){n.then(r,o)})}else e.reject("No futures passed to Promise.any()")})},r.every=function(){var n=j(arguments);return new r(function(e){if(n.length){var t=new Array(n.length),r=0,o=function(o,u){r++,t[o]=u,r==n.length&&e.resolve(t)};n.forEach(function(n,t){var r=function(){var n=Array.prototype.slice.call(arguments);return n.unshift(t),o.apply(null,n)};n.then(r,e.reject)})}else e.reject("No futures passed to Promise.every()")})},r.some=function(){var n=j(arguments);return new r(function(e){if(n.length){var t=0,r=function(){t++,t==n.length&&e.reject()};n.forEach(function(n){n.then(e.resolve,r)})}else e.reject("No futures passed to Promise.some()")})},r.fulfill=function(n){return new r(function(e){e.fulfill(n)})},r.resolve=function(n){return new r(function(e){e.resolve(n)})},r.reject=function(n){return new r(function(e){e.reject(n)})},r.deferred=function(){var n,e=new r(function(e){n=e}),t={};return["resolve","reject","fulfill","timeout","cancel"].forEach(function(e){t[e]=function(){n[e].apply(e,arguments)}}),t.promise=function(n){return n?(["then","catch"].forEach(function(t){n[t]=function(){return e[t].apply(e,arguments)}}),n):e},t},window.$&&!window.$.Deferred&&(window.$.Deferred=function(){var n=r.deferred();return n.resolveWith=function(n,e){this.resolve.apply(n,e)},n.rejectWith=function(n,e){this.reject.apply(n,e)},n}),e.promise=r}(window,window.lib||(window.lib={}));