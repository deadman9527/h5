!function(t){var i=window.navigator.userAgent.toLowerCase();SEMURL=i.match(/MobileVecn/i)?!1:!0,Global.formatImgSrc=function(t){if(!t)return"http://h5.quxiu.me/assets/img/cart_img_black_640x253.png";var i=t.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return i?"http"+i[1]+".jpg":t},Global.formatTitleLink=function(t,i,e){var o="http://"+location.host,r=i?"&brandId="+i:"",n="detail.html?productId="+t+r,s=e?e:"",a=o+"/"+s+"goods-"+t+".html?productId="+t+r,l=SEMURL?a:n;return l};var e={init:function(){var i=new lib.httpurl(location.href),e=i.params,o=e.brandId?decodeURIComponent(e.brandId):null,r=e.title?decodeURIComponent(e.title):null;if(this.title=r,r?(document.title=r,this.topbar=new ctrl.topBar({isIndex:!1,title:r})):document.title="商品列表",new lib.goTop,this.bottombar=new ctrl.bottomBar({showBottom:!0,showApp:!1,showCircle:!1}),t("#callApp").on("click",function(){var t=location.href;t=t.replace(/test.h5/g,"h5");var i=!0,e=!0;lib.callapp.gotoPage(t,{point:e,params:i})}),this.categoryId=e.categoryId||0,this.brandId=o,!this.brandId&&!this.categoryId)return void this.renderError("param");this.categoryId?t(".main-hd").remove():t(".main-hd").show(),this.is_sort=e.is_sort||7,this.is_have=e.is_have||0,this.count=20,this.page=1,this.time=!0,lib.lazyload.init();var n=this;this.infiniteScroll=lib.infiniteScroll.init({bufferPx:150,time:200,onNear:function(){n.render()},end:function(){return n.isEnd}}),this.addEvents(),this.render(),this.showPromotion=!0,this.showTime=!0},addEvents:function(){var i=this;t(".j-sort").on("click",function(){i.sortHandler(t(this))}),t(".j-filter").on("click",function(){var e=t(this);e.toggleClass("active");var o=e.hasClass("active");i.is_have=o?1:0,i.render(!0)})},render:function(i){var e=this;if(!e.isAjax){this.isAjax=!0,i&&(this.page=1,this.infiniteScroll.remove(),t("#items").html(""),this.showTip("数据加载中..."));var o={brandGroupId:this.brandId,categoryId:this.categoryId,is_sort:this.is_sort,is_have:this.is_have,count:this.count,page:this.page};null!=this.brandId&&(o.brandId=this.brandId),lib.api.get({api:{c:"deal",a:"goodslist"},data:o,success:function(t){if(console.log(t),!e.topbar){var i=t.title||document.title;document.title=i,e.topbar=new ctrl.topBar({isIndex:!1,title:i})}if(e.showPromotion&&(e.renderPromotion(t),e.showPromotion=!1),Array.isArray(t.products)&&t.products.length?(e.renderItems(t.products),!e.infiniteScroll.started&&e.infiniteScroll.start()):1==e.page?e.renderError("empty"):(console.log(e.isEnd),e.isEnd=!0),e.time&&t.surplusTime){e.time=!1,console.log(t.surplusTime);var o=parseInt(t.surplusTime),r=Math.floor(o/86400),n=Math.floor((o-24*r*3600)/3600),s=Math.floor((o-24*r*3600-3600*n)/60),a=Math.floor(o-24*r*3600-3600*n-60*s),l=[r,n,s,a];console.log(l),e.renderTime(l)}e.page++},error:function(){e.renderError("network")},complete:function(){e.isAjax=!1}})}},checkNeedScroll:function(){return!this.is_have},renderPromotion:function(i){var e=t("#promotion"),o=t("#tpl-promotion").html();e.append(_.template(o)({data:i}))},renderTime:function(i){var e=3600*parseInt(i[0])*24+3600*parseInt(i[1])+parseInt(60*i[2])+parseInt(i[3]);if(console.log(i),e>0){{lib.countdown({endDate:"+"+e.toString(),stringFormatter:i[0]>0?"d天hh小时mm分ss秒":i[1]>0?"hh小时mm分ss秒":i[2]>0?"mm分ss秒":"ss秒",onUpdate:function(i){t(".time-end").html("还剩："+i.stringValue)},onEnd:function(){console.log("cd2 ended")}}).start()}t(".time-end").show()}else t(".time-end").remove()},renderItems:function(i){t(".info-tip").hide();var e=t("#items"),o=t("#tpl-item").html(),r=t(".list-item").length;e.append(_.template(o)({brandId:this.brandId,itemList:i,sum:r})),lib.lazyload.trigger()},renderError:function(t){switch(t){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(i){var e=t(".info-tip");e.html(i).show()},sortHandler:function(i){var e=i.hasClass("active");t(".j-sort").removeClass("active"),i.addClass("active");var o=i.attr("data-type");o?(e&&i.toggleClass("down-up"),this.is_sort=i.hasClass("down-up")?"price"==o?3:5:"price"==o?4:6):this.is_sort=7,this.render(!0)}};t(function(){e.init()})}(Zepto,window.Global||(window.Global={}));