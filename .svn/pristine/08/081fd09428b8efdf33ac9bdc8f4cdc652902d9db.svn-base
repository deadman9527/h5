!function(t){var i={init:function(){var t=new lib.httpurl(location.href),i=t.params,e=i.title?decodeURIComponent(i.title):"选择优惠券";document.title=e,new ctrl.topBar({isIndex:!1,title:e}),this.code=i.code||0,this.total=i.total||0,this.proType=i.proType||0,this.render(),this.addEvents(),new lib.goTop},addEvents:function(){var i=this;t(".activate-btn").on("click",function(){var e=t(".input").val();if(e)lib.api.get({needLogin:!0,api:{c:"Coupons",a:"activateCoupon"},data:{coupon_code:e},success:function(e){console.log(e),t("#coupons").empty(),i.render()},error:function(t){var i=lib.notification.alert(t.desc,function(){this.hide()});i.show()},complete:function(){}});else{var o=lib.notification.alert("请输入优惠券码",function(){this.hide()});o.show()}})},addEventsSelect:function(){var i=this;t(".coupon-container").on("click",function(){if(t(this).hasClass("active"))t(".active .coupon-right .content").empty().append('<div class="unselected">未使用</div>'),t(".active").removeClass("active"),setTimeout(function(){window.location.href="order-confirm.html"+(i.proType?"?proType=1":"")},500),t(".coupon-container").unbind("click");else{var e=t(this).attr("data-condition");if(parseFloat(e)>parseFloat(i.total)){var o=lib.notification.alert("非常抱歉，您的订单金额未达到这张优惠券的使用要求",function(){this.hide()},{useTap:!1});o.show()}else{t(".active .coupon-right .content").empty().append('<div class="unselected">未使用</div>'),t(".active").removeClass("active"),t(this).find(".coupon-right .content").empty().append('<div class="selected"></div>'),t(this).addClass("active");var n=t(this).attr("data-code"),a=t(this).attr("data-id"),c=t(this).find(".price").text();setTimeout(function(){window.location.href="order-confirm.html?code="+n+"&value="+c+"&id="+a+(i.proType?"&proType=1":"")},500),t(".coupon-container").unbind("click")}}})},render:function(){console.log("getList");var t=this;t.isAjax||(t.isAjax=!0,lib.api.get({needLogin:!0,api:{c:"Coupons",a:"getUserConpon"},data:{useable:1},success:function(i){if(console.log(i),i.data.coupon)t.renderItems(i),t.addEventsSelect();else{var e=lib.notification.alert("优惠券列表为空哦，不过您可以通过优惠券码激活优惠券",function(){this.hide()});e.show()}},error:function(t){var i=lib.notification.alert(t.desc,function(){this.hide()});i.show()},complete:function(){t.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(i){var e=t("#coupons"),o=t("#tpl-coupon").html();e.append(_.template(o)({data:i,code:this.code}))},renderError:function(t){switch(t){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(i){var e=t(".info-tip");e.html(i).show()}};t(function(){i.init()})}(Zepto,window.Global||(window.Global={}));