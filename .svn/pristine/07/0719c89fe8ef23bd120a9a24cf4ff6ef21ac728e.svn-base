!function(n,a){function i(n){var a=this;return a.config=d.extend({el:"",isNeedHandle:!0,quantity:!1,step:1,min:0,max:999999999,cart:!1,itemid:0},n),a.$container=d(a.config.el),a.$container.length>0?a.$container.length>1?void d.each(a.$container,function(n,e){new i(d.extend(a.config,{el:e}))}):void this._init():!1}var d=n.Zepto,e='    <% if(isNeedHandle){ %>        <div class="minus J_Minus">-</div>    <% } %>        <input class="J_InputNum input-num" type="number" value="<%= quantity && quantity%>" />    <% if(isNeedHandle){ %>        <div class="add J_Add">+</div>    <% } %>';d.extend(i.prototype,{_init:function(){this.addHandler=this.config.onAdd,this.minusHandler=this.config.onMinus,this.blurHandler=this.config.onBlur;var n=this;n.$container.addClass("ctrl-number clearfix"),n.config.isNeedHandle||n.$container.addClass("no-handle"),n.max=n.config.max,n.min=n.config.min,n.step=n.config.step,n.isNeedHandle=n.config.isNeedHandle,n.cart=n.config.cart,n.itemid=n.config.itemid,n._render(n.$container,n.config),n._bindEvent(n.$container),setTimeout(function(){n.$container.trigger("number:after:render",{})},100)},_render:function(n,a){var i=this;n.html(_.template(e)(a)),i.$inputNum=n.find(".J_InputNum"),n.attr("defnum")&&(n.find(".J_InputNum").val(n.attr("defnum")),n.attr("defnum")==n.attr("max")&&n.find(".J_Add").addClass("add-disabled")),n.attr("itemid")&&(i.itemid=n.attr("itemid")),i.isNeedHandle&&(i.$add=n.find(".J_Add"),i.$minus=n.find(".J_Minus"))},_bindEvent:function(n){var a=this,i=a.step;a.$add&&a.$add.on("click",function(){if(!d(this).hasClass("add-disabled")){var e=parseInt(a.$inputNum.val(),10)+i;a._dealInputHandle(e,n,"add",1)}}),a.$minus&&a.$minus.on("click",function(){if(!d(this).hasClass("minus-disabled")){var e=parseInt(a.$inputNum.val(),10)-i;a._dealInputHandle(e,n,"minus",-1)}}),a.$inputNum.on("blur",function(){var i=a.$inputNum.val();isNaN(i)&&(i=a.min,a.$inputNum.val(i)),i!=a.lastFocusVal&&a._dealInputHandle(i,n,"blur",parseInt(i-a.lastFocusVal))}),a.$inputNum.on("focus",function(){var n=parseInt(a.$inputNum.val(),10);a.lastFocusVal=n})},_dealInputHandle:function(n,a,i){var e=this;e.cart?(min=parseInt(d(a).attr("min")),max=parseInt(d(a).attr("max"))):(min=e.min,max=e.max),isNaN(n)||min>=n?(min>n&&"blur"==i&&a.trigger("number:less:min",{lessNum:n,nowNum:min}),n=min,e.$add&&e.$add.removeClass("add-disabled"),e.$minus&&e.$minus.addClass("minus-disabled"),e.cart&&("add"==i&&e.addHandler&&e.addHandler(),"minus"==i&&e.minusHandler&&e.minusHandler(),"blur"==i&&e.blurHandler&&e.blurHandler())):n>min&&max>n?(e.$minus&&e.$minus.removeClass("minus-disabled"),e.$add&&e.$add.removeClass("add-disabled"),e.cart&&("add"==i&&e.addHandler&&e.addHandler(),"minus"==i&&e.minusHandler&&e.minusHandler(),"blur"==i&&e.blurHandler&&e.blurHandler())):n>=max&&(n>max&&"blur"==i&&a.trigger("number:over:max",{overNum:n,nowNum:max}),n=max,e.$minus&&e.$minus.removeClass("minus-disabled"),e.$add&&e.$add.addClass("add-disabled"),e.cart&&("add"==i&&e.addHandler&&e.addHandler(),"minus"==i&&e.minusHandler&&e.minusHandler(),"blur"==i&&e.blurHandler&&e.blurHandler())),e.$inputNum.val(n),a.trigger("number:change",{nowNum:n,fireType:i})}}),d.fn.number=function(n){return n=n||{},n.el=this,new i(n)},a.number=i}(window,window.ctrl||(window.ctrl={}));