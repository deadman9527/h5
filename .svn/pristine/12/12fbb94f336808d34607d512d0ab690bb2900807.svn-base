!function(e){var t={init:function(){this.isRegister=location.href.indexOf("register")>-1;var e=new lib.httpurl(location.href),t=e.params;t.redirectUrl=t.redirectUrl?t.redirectUrl:"",this.redirectUrl=t.redirectUrl,this.addEvents(),this.topbar=new ctrl.topBar({isIndex:!1}),this.bottombar=new ctrl.bottomBar({showBottom:!0,showApp:!1,showCircle:!1})},addEvents:function(){var t=this;this.transmit(),e("#submit").on("click",function(){t.submit()}),e("#get-code").on("click",function(){t.getCode()}),e("#resetPasswd").on("click",function(){t.reset()})},transmit:function(){var t=this,i=location.href.indexOf("http://h5.quxiu.me")>-1,r="";i?(r=t.redirectUrl?"http://h5.quxiu.me/login.html?redirectUrl="+encodeURIComponent(t.redirectUrl):"http://h5.quxiu.me/login.html",e("#has-account").attr("href",r)):(r=t.redirectUrl?"login.html?redirectUrl="+encodeURIComponent(t.redirectUrl):"login.html",e("#has-account").attr("href",r))},submit:function(){var e=this;e.isAjax||this.verify()&&(e.isAjax=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"user",a:"signup"},data:{phone:this.mobile,password:this.password,verify_code:this.code,source:"h5",r:lib.storage.get("register_r")&&lib.storage.get("register_r").r||null,pid:lib.storage.get("pid")&&lib.storage.get("pid")||null,utm_medium:lib.storage.get("register_r")&&lib.storage.get("register_r").utm||null},success:function(e){console.log(e),lib.h5log.log(["setCustomVariable",3,"isRegister",1,"visit"]);var t=null;lib.login.login(e,t)},error:function(t){console.log(e.isRegister?"注册失败！":"重置密码失败！"),t&&t.desc&&alert(t.desc)},complete:function(){setTimeout(function(){e.isAjax=!1},1e3)}}),lib.storage.get("register_r")&&lib.storage.set("register_r",null))},reset:function(){var e=this;e.isAjaxReset||this.verify()&&(e.isAjaxReset=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"user",a:"changepwd"},data:{phone:this.mobile,password:this.password,verify_code:this.code,source:"h5"},success:function(t){console.log(t),location.href=e.redirectUrl?"login.html?redirectUrl="+encodeURIComponent(e.redirectUrl):"login.html"},error:function(e){console.log("注册失败"),e&&e.desc&&alert(e.desc)},complete:function(){e.isAjaxReset=!1}}))},getCode:function(){var e=this;1!=e.isAjaxGetcode&&this.verify("tel")&&(e.isAjaxGetcode=!0,lib.api.get({api:{c:"sms",a:"sendMsg"},data:{mobile:this.mobile,status:this.isRegister?"register":""},success:function(t){console.log(t),alert("发送成功"),e.timerClock("#get-code")},error:function(e){console.log(e),alert(e&&e.desc?e.desc:"请求验证码失败")},complete:function(){setTimeout(function(){e.isAjaxGetcode=!1},1e3)}}))},verify:function(t){return this.mobile=e("#tel").val(),this.code=e("#code").val(),this.password=e("#password").val(),0==arguments.length?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?0==this.password.length?(alert("密码不能为空"),!1):/^[0-9]{6}$/.test(this.code)?!0:(alert("验证码不正确！"),!1):(alert("手机号码不正确！"),!1):1==arguments.length&&(t="tel")?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?!0:(alert("手机号码不正确！"),!1):void 0},timerClock:function(t){var i=this,r=60;i.verifyFlag=1,e(t).addClass("getcode-icon").html("剩余 "+r+" 秒"),e(t).off();var s=setInterval(function(){1>=r?(clearInterval(s),i.verifyFlag=0,e(t).removeClass("getcode-icon").html("获取验证码"),e(t).on("click",function(){i.getCode()})):(r--,e(t).html("剩余 "+r+" 秒"))},1e3)}};e(function(){t.init()})}(Zepto);