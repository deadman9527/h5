!function(a){var b={init:function(){this.isRegister=location.href.indexOf("register")>-1;var a=new lib.httpurl(location.href),b=a.params;b.redirectUrl=b.redirectUrl?b.redirectUrl:"",this.redirectUrl=b.redirectUrl,this.addEvents(),this.topbar=new ctrl.topBar({isIndex:!1}),this.bottombar=new ctrl.bottomBar({showBottom:!0,showApp:!1,showCircle:!1})},addEvents:function(){var b=this;this.transmit(),a("#submit").on("click",function(){b.submit()}),a("#get-code").on("click",function(){b.getCode()}),a("#resetPasswd").on("click",function(){b.reset()})},transmit:function(){var b=this,c=location.href.indexOf("http://h5.ve.cn")>-1,d="";c?(d=b.redirectUrl?"http://h5.ve.cn/login.html?redirectUrl="+encodeURIComponent(b.redirectUrl):"http://h5.ve.cn/login.html",a("#has-account").attr("href",d)):(d=b.redirectUrl?"login.html?redirectUrl="+encodeURIComponent(b.redirectUrl):"login.html",a("#has-account").attr("href",d))},submit:function(){var a=this;a.isAjax||this.verify()&&(a.isAjax=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"user",a:"signup"},data:{phone:this.mobile,password:this.password,verify_code:this.code,source:"h5",r:lib.storage.get("register_r")&&lib.storage.get("register_r").r||null,pid:lib.storage.get("pid")&&lib.storage.get("pid")||null,utm_medium:lib.storage.get("register_r")&&lib.storage.get("register_r").utm||null},success:function(a){console.log(a),lib.h5log.log(["setCustomVariable",3,"isRegister",1,"visit"]);var b=null;lib.login.login(a,b)},error:function(b){console.log(a.isRegister?"注册失败！":"重置密码失败！"),b&&b.desc&&alert(b.desc)},complete:function(){setTimeout(function(){a.isAjax=!1},1e3)}}),lib.storage.get("register_r")&&lib.storage.set("register_r",null))},reset:function(){var a=this;a.isAjaxReset||this.verify()&&(a.isAjaxReset=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"user",a:"changepwd"},data:{phone:this.mobile,password:this.password,verify_code:this.code,source:"h5"},success:function(b){console.log(b),location.href=a.redirectUrl?"login.html?redirectUrl="+encodeURIComponent(a.redirectUrl):"login.html"},error:function(a){console.log("注册失败"),a&&a.desc&&alert(a.desc)},complete:function(){a.isAjaxReset=!1}}))},getCode:function(){var a=this;1!=a.isAjaxGetcode&&this.verify("tel")&&(a.isAjaxGetcode=!0,lib.api.get({api:{c:"sms",a:"sendMsg"},data:{mobile:this.mobile,status:this.isRegister?"register":""},success:function(b){console.log(b),alert("发送成功"),a.timerClock("#get-code")},error:function(a){console.log(a),alert(a&&a.desc?a.desc:"请求验证码失败")},complete:function(){setTimeout(function(){a.isAjaxGetcode=!1},1e3)}}))},verify:function(b){return this.mobile=a("#tel").val(),this.code=a("#code").val(),this.password=a("#password").val(),0==arguments.length?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?0==this.password.length?(alert("密码不能为空"),!1):/^[0-9]{6}$/.test(this.code)?!0:(alert("验证码不正确！"),!1):(alert("手机号码不正确！"),!1):1==arguments.length&&(b="tel")?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?!0:(alert("手机号码不正确！"),!1):void 0},timerClock:function(b){var c=this,d=60;c.verifyFlag=1,a(b).addClass("getcode-icon").html("剩余 "+d+" 秒"),a(b).off();var e=setInterval(function(){1>=d?(clearInterval(e),c.verifyFlag=0,a(b).removeClass("getcode-icon").html("获取验证码"),a(b).on("click",function(){c.getCode()})):(d--,a(b).html("剩余 "+d+" 秒"))},1e3)}};a(function(){b.init()})}(Zepto);