!function(a){var b={init:function(){var a=new lib.httpurl(location.href),b=a.params;this.proType=parseInt(b.proType)||0,this.addEvents(),this.topbar=new ctrl.topBar({isIndex:!1})},addEvents:function(){var b=this;a("#submit").on("click",function(){b.submit()}),a("#get-code").on("click",function(){b.getCode()})},submit:function(){var a=this;a.isAjax||this.verify()&&(a.isAjax=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"FreeUser",a:"free_register"},data:{phone:this.mobile,verify_code:this.code,app:"h5"},success:function(b){console.log(b),b.user.area=b.user.area?b.user.area:{},b.user.area.phone=a.mobile,lib.storage.set("editAddressData",b.user.area),lib.login.login(b,"address-add.html?isDirect=1&proType="+a.proType)},error:function(a){a&&a.desc&&alert(a.desc)},complete:function(){setTimeout(function(){a.isAjax=!1},1e3)}}),lib.storage.get("register_r")&&lib.storage.set("register_r",null))},getCode:function(){var a=this;1!=a.isAjaxGetcode&&this.verify("tel")&&(a.isAjaxGetcode=!0,lib.api.get({api:{c:"sms",a:"sendMsg"},data:{mobile:this.mobile,status:"free_user"},success:function(b){console.log(b),alert("发送成功"),a.timerClock("#get-code")},error:function(a){console.log(a),alert(a&&a.desc?a.desc:"请求验证码失败")},complete:function(){setTimeout(function(){a.isAjaxGetcode=!1},1e3)}}))},verify:function(b){return this.mobile=a("#tel").val(),this.code=a("#code").val(),0==arguments.length?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?/^[0-9]{6}$/.test(this.code)?!0:(alert("验证码不正确！"),!1):(alert("手机号码不正确！"),!1):1==arguments.length&&(b="tel")?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?!0:(alert("手机号码不正确！"),!1):void 0},timerClock:function(b){var c=this,d=60;c.verifyFlag=1,a(b).addClass("getcode-icon").html("剩余 "+d+" 秒"),a(b).off();var e=setInterval(function(){1>=d?(clearInterval(e),c.verifyFlag=0,a(b).removeClass("getcode-icon").html("获取验证码"),a(b).on("click",function(){c.getCode()})):(d--,a(b).html("剩余 "+d+" 秒"))},1e3)}};a(function(){b.init()})}(Zepto);