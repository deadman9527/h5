!function(a,b){function c(a){var b=this;return b.config=d.extend({el:"",isNeedHandle:!0,quantity:!1,step:1,min:0,max:999999999,cart:!1,itemid:0},a),b.$container=d(b.config.el),b.$container.length>0?b.$container.length>1?void d.each(b.$container,function(a,e){new c(d.extend(b.config,{el:e}))}):void this._init():!1}var d=a.Zepto,e='    <% if(isNeedHandle){ %>        <div class="minus J_Minus">-</div>    <% } %>        <input class="J_InputNum input-num" type="number" value="<%= quantity && quantity%>" />    <% if(isNeedHandle){ %>        <div class="add J_Add">+</div>    <% } %>';d.extend(c.prototype,{_init:function(){this.addHandler=this.config.onAdd,this.minusHandler=this.config.onMinus,this.blurHandler=this.config.onBlur;var a=this;a.$container.addClass("ctrl-number clearfix"),a.config.isNeedHandle||a.$container.addClass("no-handle"),a.max=a.config.max,a.min=a.config.min,a.step=a.config.step,a.isNeedHandle=a.config.isNeedHandle,a.cart=a.config.cart,a.itemid=a.config.itemid,a._render(a.$container,a.config),a._bindEvent(a.$container),setTimeout(function(){a.$container.trigger("number:after:render",{})},100)},_render:function(a,b){var c=this;a.html(_.template(e)(b)),c.$inputNum=a.find(".J_InputNum"),a.attr("defnum")&&(a.find(".J_InputNum").val(a.attr("defnum")),a.attr("defnum")==a.attr("max")&&a.find(".J_Add").addClass("add-disabled")),a.attr("itemid")&&(c.itemid=a.attr("itemid")),c.isNeedHandle&&(c.$add=a.find(".J_Add"),c.$minus=a.find(".J_Minus"))},_bindEvent:function(a){var b=this,c=b.step;b.$add&&b.$add.on("click",function(){if(!d(this).hasClass("add-disabled")){var e=parseInt(b.$inputNum.val(),10)+c;b._dealInputHandle(e,a,"add",1)}}),b.$minus&&b.$minus.on("click",function(){if(!d(this).hasClass("minus-disabled")){var e=parseInt(b.$inputNum.val(),10)-c;b._dealInputHandle(e,a,"minus",-1)}}),b.$inputNum.on("blur",function(){var c=b.$inputNum.val();isNaN(c)&&(c=b.min,b.$inputNum.val(c)),c!=b.lastFocusVal&&b._dealInputHandle(c,a,"blur",parseInt(c-b.lastFocusVal))}),b.$inputNum.on("focus",function(){var a=parseInt(b.$inputNum.val(),10);b.lastFocusVal=a})},_dealInputHandle:function(a,b,c){var e=this;e.cart?(min=parseInt(d(b).attr("min")),max=parseInt(d(b).attr("max"))):(min=e.min,max=e.max),isNaN(a)||a<=min?(a<min&&"blur"==c&&b.trigger("number:less:min",{lessNum:a,nowNum:min}),a=min,e.$add&&e.$add.removeClass("add-disabled"),e.$minus&&e.$minus.addClass("minus-disabled"),e.cart&&("add"==c&&e.addHandler&&e.addHandler(),"minus"==c&&e.minusHandler&&e.minusHandler(),"blur"==c&&e.blurHandler&&e.blurHandler())):a>min&&a<max?(e.$minus&&e.$minus.removeClass("minus-disabled"),e.$add&&e.$add.removeClass("add-disabled"),e.cart&&("add"==c&&e.addHandler&&e.addHandler(),"minus"==c&&e.minusHandler&&e.minusHandler(),"blur"==c&&e.blurHandler&&e.blurHandler())):a>=max&&(a>max&&"blur"==c&&b.trigger("number:over:max",{overNum:a,nowNum:max}),a=max,e.$minus&&e.$minus.removeClass("minus-disabled"),e.$add&&e.$add.addClass("add-disabled"),e.cart&&("add"==c&&e.addHandler&&e.addHandler(),"minus"==c&&e.minusHandler&&e.minusHandler(),"blur"==c&&e.blurHandler&&e.blurHandler())),e.$inputNum.val(a),b.trigger("number:change",{nowNum:a,fireType:c})}}),d.fn.number=function(a){return a=a||{},a.el=this,new c(a)},b.number=c}(window,window.ctrl||(window.ctrl={}));