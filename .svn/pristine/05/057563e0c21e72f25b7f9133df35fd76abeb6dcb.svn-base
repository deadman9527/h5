!function(a){var b={init:function(){var a=new lib.httpurl(location.href),b=a.params,c=b.title?decodeURIComponent(b.title):"选择优惠券";document.title=c,new ctrl.topBar({isIndex:!1,title:c}),this.code=b.code||0,this.total=b.total||0,this.proType=b.proType||0,this.render(),this.addEvents(),new lib.goTop},addEvents:function(){var b=this;a(".activate-btn").on("click",function(){var c=a(".input").val();if(c)lib.api.get({needLogin:!0,api:{c:"Coupons",a:"activateCoupon"},data:{coupon_code:c},success:function(c){console.log(c),a("#coupons").empty(),b.render()},error:function(a){var b=lib.notification.alert(a.desc,function(){this.hide()});b.show()},complete:function(){}});else{var d=lib.notification.alert("请输入优惠券码",function(){this.hide()});d.show()}})},addEventsSelect:function(){var b=this;a(".coupon-container").on("click",function(){if(a(this).hasClass("active"))a(".active .coupon-right .content").empty().append('<div class="unselected">未使用</div>'),a(".active").removeClass("active"),setTimeout(function(){window.location.href="order-confirm.html"+(b.proType?"?proType=1":"")},500),a(".coupon-container").unbind("click");else{var c=a(this).attr("data-condition");if(parseFloat(c)>parseFloat(b.total)){var d=lib.notification.alert("非常抱歉，您的订单金额未达到这张优惠券的使用要求",function(){this.hide()},{useTap:!1});d.show()}else{a(".active .coupon-right .content").empty().append('<div class="unselected">未使用</div>'),a(".active").removeClass("active"),a(this).find(".coupon-right .content").empty().append('<div class="selected"></div>'),a(this).addClass("active");var e=a(this).attr("data-code"),f=a(this).attr("data-id"),g=a(this).find(".price").text();setTimeout(function(){window.location.href="order-confirm.html?code="+e+"&value="+g+"&id="+f+(b.proType?"&proType=1":"")},500),a(".coupon-container").unbind("click")}}})},render:function(){console.log("getList");var a=this;a.isAjax||(a.isAjax=!0,lib.api.get({needLogin:!0,api:{c:"Coupons",a:"getUserConpon"},data:{useable:1},success:function(b){if(console.log(b),b.data.coupon)a.renderItems(b),a.addEventsSelect();else{var c=lib.notification.alert("优惠券列表为空哦，不过您可以通过优惠券码激活优惠券",function(){this.hide()});c.show()}},error:function(a){var b=lib.notification.alert(a.desc,function(){this.hide()});b.show()},complete:function(){a.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(b){var c=a("#coupons"),d=a("#tpl-coupon").html();c.append(_.template(d)({data:b,code:this.code}))},renderError:function(a){switch(a){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(b){var c=a(".info-tip");c.html(b).show()}};a(function(){b.init()})}(Zepto,window.Global||(window.Global={}));