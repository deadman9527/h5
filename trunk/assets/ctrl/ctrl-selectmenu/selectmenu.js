!function(a,b){var c={open:function(a,b){if(a){var c=a.firstChild;a.style.opacity=1,a.style.visibility="visible",setTimeout(function(){c.style.webkitTransform="translateY(0)",b&&b()},0)}},close:function(a,b){if(a){var c=a.firstChild;c.style.webkitTransform="translateY(100%)",setTimeout(function(){a.style.opacity=0,a.style.visibility="hidden",b&&b()},200)}}},d=0,e={container:"ctrl-selectmenu",innerBox:"ctrl-selectmenu-picker",header:"ctrl-selectmenu-header",confirm:"ctrl-selectmenu-btn-confirm",cancel:"ctrl-selectmenu-btn-cancel",col:"ctrl-selectmenu-col",option:"ctrl-selectmenu-option",wrapper:"ctrl-selectmenu-wrapper"},f=function(a,b){var f=this,g=Date.now()+"-"+ ++d,h=document.createDocumentFragment();1!==arguments.length||arguments[0]instanceof HTMLElement||(b=arguments[0],a=null),a||(a=document.createElement("div")),h.appendChild(a),a.setAttribute("data-ctrl-name","selectmenu"),a.setAttribute("data-ctrl-id",g),a.className=e.container,this.options=b;var i=b.title||"";Object.defineProperty(this,"title",{get:function(){return i},set:function(b){if(!b)throw new Error("Non expected value");i=b,a.querySelector(".tip").innerHTML=b}});var j=b.confirmText||"确定";Object.defineProperty(this,"confirmText",{get:function(){return j},set:function(b){if(!b)throw new Error("Non expected value");j=b,a.querySelector("."+e.confirm).innerHTML=b}});var k=b.cancelText||"取消";Object.defineProperty(this,"cancelText",{get:function(){return k},set:function(b){if(!b)throw new Error("Non expected value");k=b,a.querySelector("."+e.cancel).innerHTML=b}});var l;Object.defineProperty(this,"viewModel",{get:function(){return l},set:function(a){if(!a)throw new Error("Non expected value");l=a,f.syncViewModel()}}),this.syncViewModel=function(){var a=this;this.render(),setTimeout(function(){a.addEvents()},100)},this._events={},this.addEventListener=function(a,b){this._events[a]||(this._events[a]=[]),this._events[a].push(b)},this.removeEventListener=function(a,b){if(this._events[a]){var c=this._events[a].indexOf(b);c>-1&&this._events[a].splice(c,1)}},this.execEvent=function(a){if(this._events[a]){var b=0,c=this._events[a].length;if(c)for(;c>b;b++)this._events[a][b].apply(this,[].slice.call(arguments,1))}},this.remove=function(){a.parentNode&&a.parentNode.removeChild(a)},this.element=a,this.root=h;var m={},n={},o={};this.render=function(){var a=l,b=['<div class="'+e.header+'">','<a href="javascript:void(0);" class="'+e.cancel+'">'+k+"</a>",'<span class="tip">'+i+"</span>",'<a href="javascript:void(0);" class="'+e.confirm+'">'+j+"</a>","</div>"].join(""),c='<div class="'+e.wrapper+'"></div>';this.element.innerHTML='<div class="'+e.innerBox+'">'+b+c+"</div>";for(var d in a)this.renderColumn(d,a[d]);this.refresh()},this.selectedIndex={},this.renderColumn=function(a,b){var c=this;if(!Array.isArray(b))throw"select项数据列表必须是数组";var d=[];c.selectedIndex[a]=0,b.forEach(function(b,f){b.selected&&(c.selectedIndex[a]=f),d.push('<div class="'+e.option+'" data-value="'+b.value+'">'+b.key+"</div>")});var f=d.join(""),g=c.element.querySelector("."+e.wrapper),h=g.querySelector("[data-type="+a+"]");if(h)h.firstChild.innerHTML=f;else{var i='<div class="scroller">'+f+"</div>",j=document.createElement("div");j.className=e.col,j.setAttribute("data-type",a),j.innerHTML=i,g.appendChild(j)}},this.setScroll=function(){var a=this,b=[].slice.call(this.element.querySelectorAll("."+e.col));b.forEach(function(b){var c=b.querySelector(".scroller"),d=lib.scroll({scrollElement:c,inertia:"slow"}).init();c.addEventListener("click",function(a){var b=a.target;0===b.className.indexOf(e.option)&&d.scrollToElement(b,!0)},!1),d.addScrollendHandler(function(){a.scrollEndHandler(d,b)});var f=b.getAttribute("data-type");a.scrollToNthChild(d,a.selectedIndex[f]),d.handler=!0,m[f]=d}),this.selects=b,this.scrolls=m},this.currentColName="",this.scrollEndHandler=function(a,b){if(!a.handler)return void(a.handler=!0);var c=a.getScrollTop(),d=Math.round(c/this.height);a.handler=!1,this.scrollToNthChild(a,d,!1);var e=b.getAttribute("data-type");this.currentColName=e,this.setSelectedStatus(e,Math.abs(d)),this.execEvent("select",e)},this.setSelectedStatus=function(a,b){var c=this.scrolls[a].element,d=c.querySelectorAll("."+e.option);n[a]=c.querySelector(".current"),n[a]&&(n[a].className=e.option),n[a]=d[b],n[a].className=e.option+" current",o["val-"+a]=n[a].getAttribute("data-value"),o["key-"+a]=n[a].innerHTML,this.selectedValue=o,this.selectedIndex[a]=b},this.resetScrollPos=function(){var a=this;this.selects&&this.selects.forEach(function(b){var c=b.getAttribute("data-type"),d=a.scrolls[c];a.scrollToNthChild(d,a.selectedIndex[c])})},this.scrollToNthChild=function(a,b,c){var d=a.element,e=d.querySelector(":nth-child("+(1+b)+")"),f="undefined"!=typeof c?c:!0;a.scrollToElement(e,f)};var p=!1,q=!1;this.addEvents=function(){function a(){c.refresh()}var b=this.options,c=this;if(!q){var d;if(window.addEventListener("resize",function(){clearTimeout(d),d=setTimeout(a,310)},!1),b.trigger){var f=b.trigger.length>1?[].slice.call(b.trigger):[b.trigger];f.forEach(function(a){a.addEventListener("click",function(){c.trigger=a,c.show()})})}q=!0}this.element.querySelector("."+e.confirm).addEventListener("click",function(){if(b.verifyMe){if(!b.verifyMe(c.selectedValue))return;c.hide()}else c.hide();c.execEvent("confirm",c.trigger)},!1),this.element.querySelector("."+e.cancel).addEventListener("click",function(){c.execEvent("cancel",c.trigger),c.hide()},!1)},this.show=function(){var a=this;this.execEvent("beforeShow",a.trigger),c.open(this.element),setTimeout(function(){p||(a.setScroll(),p=!0)},100),this.execEvent("show")},this.hide=function(){c.close(this.element),this.execEvent("hide")},this.refresh=function(){var a=this,b=setInterval(function(){var c="."+e.option,d=document.querySelector(c);d&&d.clientHeight&&(a.height=d.clientHeight,a.resetScrollPos(),clearInterval(b),b=null)},100)},this.linkage=function(a,b){this.viewModel[a]=b,this.renderColumn(a,b);var c=this.scrolls[a],d=this.selectedIndex[a];c.refresh(),this.scrollToNthChild(c,d)},this.scrollToIndex=function(a,b){var c=this.scrolls[a];this.scrollToNthChild(c,b),this.setSelectedStatus(a,b)}};b.selectmenu=f}(window,window.ctrl||(window.ctrl={}));