!function(a){Global.formatImgSrc=function(a){if(!a)return"http://h5.ve.cn/assets/img/cart_img_black_640x253.png";var b=a.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return b?"http"+b[1]+".jpg":a};var b={init:function(){var a=new lib.httpurl(location.href),b=a.params,c=b.title?decodeURIComponent(b.title):"买二送一活动";document.title=c,this.page=1,new ctrl.topBar({isIndex:!1,title:c}),lib.lazyload.init();var d=this;this.infiniteScroll=lib.infiniteScroll.init({bufferPx:150,time:200,onNear:function(){d.render()},end:function(){return d.isEnd}}),this.render(),new lib.goTop},addEvents:function(){a(".save-btn").on("click",function(){lib.storage.set("addressSelectedId",a(".active").closest(".address-container").attr("data-id")),window.location.href="order-confirm.html"})},addEventsSelect:function(){var b=this;a(".address-container").on("click",function(){if(b.is_select)a(this).find(".active").length||(a(".active").remove(),a(this).append('<span class="active"></span>'));else{var c=a(this).index();lib.storage.set("editAddressData",b.addressData[c]),window.location.href="address-add.html?title=编辑地址"}})},render:function(){var a=this;a.isAjax||(a.isAjax=!0,lib.api.get({api:{c:"deal",a:"goodslist"},data:{brandGroupId:1293,categoryId:0,brandId:1293,is_sort:7,is_have:0,count:20,page:a.page},success:function(b){console.log(b),Array.isArray(b.products)?(a.renderItems(b.products),a.checkNeedScroll()&&!a.infiniteScroll.started&&a.infiniteScroll.start()):1==a.page?a.renderError("empty"):a.isEnd=!0,lib.snow({minSize:5,maxSize:20,newOn:100,stopTime:15e3}),a.page++},error:function(){a.renderError("network")},complete:function(){a.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(b){var c=a("#goods"),d=a("#tpl-items").html();c.append(_.template(d)({data:b})),lib.lazyload.trigger()},renderError:function(a){switch(a){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(b){var c=a(".info-tip");c.html(b).show()}};a(function(){b.init()})}(Zepto,window.Global||(window.Global={}));