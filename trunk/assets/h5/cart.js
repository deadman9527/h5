!function(a){var b,c=document.documentElement,d=a(window).height();console.log(d);var e=500>d?.45:.5625,f={init:function(){lib.login.isLogin()||lib.storage.set("accessToken","");var b=new lib.httpurl(location.href),c=b.params,d=c.title?decodeURIComponent(c.title):"购物车";document.title=d,this.topbar=new ctrl.topBar({isIndex:!1,title:d}),this.bottombar=new ctrl.bottomBar({hoverIndex:2,showBottom:!0}),this.proType=1,this.render(),this.choose=2==c.type?2:null,this.renderContent();var e=window.navigator.userAgent.toLowerCase();return e.match(/MicroMessenger/i)||e.match(/MobileVecn/i)?void a(".container").css("padding","0"):void new lib.goTop({position:{bottom:60}})},"switch":function(){var b=this;a.get("http://act.ve.cn/data/switch.json",function(c){b["switch"]=c,(c.turnoff||lib.login.isLogin())&&a("#products .cart-bottom .cart-t a").attr("href","order-confirm.html")})},addEvent:function(){var b=this;a("#btn-pro").click(function(){a("#btn-sea").removeClass("hover"),a(this).addClass("hover"),b.proType=1,a("#products").show(),a("#sea_products").hide(),a("#products .cart-item").length<1?a(".container").removeClass("heiauto"):a(".container").addClass("heiauto")}),a("#btn-sea").click(function(){a("#btn-pro").removeClass("hover"),a(this).addClass("hover"),b.proType=0,a("#products").hide(),a("#sea_products").show(),a("#sea_products .cart-item").length<1?a(".container").removeClass("heiauto"):a(".container").addClass("heiauto")})},render:function(){},renderContent:function(){var d=this;d.cart_isAjax||(d.cart_isAjax=!0,lib.api.get({api:{c:"shoping",a:"get_User_Cart"},data:{accessToken:lib.storage.get("accessToken")},success:function(f){if(console.log(f),f.products&&f.products[0])for(var g=f.products.length-1;g>=0;g--)f.products[g].orders&&f.products[g].orders[0]||f.products.splice(g,1);d.editData=f;var h=a("#mainItem"),i=a("#tpl-mainItem").html();h.prepend(_.template(i)({itemList:[f]})),new ctrl.number({el:".J_Num1",step:1,quantity:1,min:0,max:3,cart:!0,onAdd:function(){d.renderDel(this,"add")},onMinus:function(){d.renderDel(this,"minus")},onBlur:function(){d.renderDel(this,"blur")}}),a(".delete-cart").click(function(){d.renderDel(this,"del")}),d.addEvent(),f.products||f.sea_products?(!f.products||f.products.length<1?(b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>')):(!f.sea_products||f.sea_products.length<1)&&(b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#sea_products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>')),1==d.proType&&(!f.products||f.products.length<=0)&&f.sea_products&&f.sea_products.length>0&&(a("#btn-pro").removeClass("hover"),a("#btn-sea").addClass("hover"),d.proType=0,a("#products").hide(),a("#sea_products").show()),1==d.proType&&(!f.products||f.products.length>0)&&a(".container").addClass("heiauto"),0==d.proType&&f.sea_products&&f.sea_products.length>0&&a(".container").addClass("heiauto"),a("#cart-sea").click(function(){d.editData&&!d.editData.is_sea_order?lib.notification.alert(d.editData.sea_limit_message,function(){this.hide()}).show():window.location.href=d["switch"].turnoff?"order-confirm.html?proType=1":lib.login.isLogin()?"order-confirm.html?proType=1":"direct-order-confirm.html?proType=1"})):(b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#mainItem").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>')),2==d.choose&&(a("#btn-pro").removeClass("hover"),a("#btn-sea").addClass("hover"),d.proType=0,a("#products").hide(),a("#sea_products").show(),a("#sea_products .cart-item").length<1?a(".container").removeClass("heiauto"):a(".container").addClass("heiauto")),d["switch"]()},error:function(d){b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#mainItem").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>'),console.log(d,d.desc)},complete:function(){d.cart_isAjax=!1}}))},renderDel:function(b,c){var d=this,e=0,f=0;"del"==c?(e=0,f=a(b).attr("itemid")):"add"==c?(e=a(b.$inputNum).attr("valueAsNumber")+1,f=b.itemid):"minus"==c?(e=a(b.$inputNum).attr("valueAsNumber")-1,e>0&&(f=b.itemid)):"blur"==c&&(e=a(b.$inputNum).attr("valueAsNumber"),f=b.itemid);var g=a(b.$container).attr("min")-1||0;if(g>=e){var h=lib.notification.confirm("确认删除","",function(e,g){g?("minus"==c&&(f=b.itemid),d.renderConDel(c,f,0,b)):"minus"==c?0==parseInt(a(b.$inputNum).val())&&a(b.$inputNum).val(a(b.$inputNum).attr("valueAsNumber")+1):a(b.$inputNum).val(b.lastFocusVal),this.hide()},"{background:#fff}");h.show()}else d.renderConDel(c,f,e,b)},renderConDel:function(d,f,g,h){var i=1;"add"==d||"minus"==d?(h.$add.addClass("add-disabled"),h.$minus.addClass("minus-disabled"),i="add"==d?1:-1):"blur"==d&&(a(h.$inputNum).attr("valueAsNumber")>=parseInt(a(h.$container).attr("max"))&&(g=parseInt(a(h.$container).attr("max"))),a(h.$inputNum).attr("valueAsNumber")<=parseInt(a(h.$container).attr("min"))&&(g=parseInt(a(h.$container).attr("min"))));var j={num:g,v:"1.6",itemid:f},k=this;k.del_isAjax||(k.del_isAjax=!0,lib.api.get({api:{c:"shoping",a:"cart_edit_new"},data:{json:"["+JSON.stringify(j)+"]",accessToken:lib.storage.get("accessToken")},success:function(f){k.editData=f;var j;if("del"==d){var l=a(a(h).closest(".recom")),m=l.find(".J_Num1 input").attr("valueAsNumber")*(parseFloat(l.find(".J_Num1").attr("origin_price"))-parseFloat(l.find(".J_Num1").attr("price")));1==a(h).closest(".cart-item").find(".recom").length?a(h).closest(".cart-item").remove():a(h).closest(".recom").remove(),1==k.proType?(a(".hjNum").html(f.total_price.toFixed(2)),j=parseFloat(a(".jsNum").html()),a(".jsNum").html((j-m.toFixed(2)).toFixed(2))):(a(".hjNum0").html(f.sea_total_price.toFixed(2)),j=parseFloat(a(".jsNum0").html()),a(".jsNum0").html((j-m.toFixed(2)).toFixed(2)))}else"add"==d||"minus"==d?(a(h.$inputNum).attr("valueAsNumber")<parseInt(a(h.$container).attr("max"))&&h.$add.removeClass("add-disabled"),a(h.$inputNum).attr("valueAsNumber")>parseInt(a(h.$container).attr("min"))&&h.$minus.removeClass("minus-disabled"),1==k.proType?(j=parseFloat(a(".jsNum").html()),a(".hjNum").html(f.total_price.toFixed(2)),a(".jsNum").html((j+parseFloat(parseFloat(h.$container.attr("origin_price"))-parseFloat(h.$container.attr("price"))).toFixed(2)*i).toFixed(2))):(j=parseFloat(a(".jsNum0").html()),a(".hjNum0").html(f.sea_total_price.toFixed(2)),a(".jsNum0").html((j+parseFloat(parseFloat(h.$container.attr("origin_price"))-parseFloat(h.$container.attr("price"))).toFixed(2)*i).toFixed(2))),0==g&&(1==a(h.$container).closest(".cart-item").find(".recom").length?a(h.$container).closest(".cart-item").remove():a(h.$container).closest(".recom").remove())):"blur"==d&&(i=a(h.$inputNum).attr("valueAsNumber")-h.lastFocusVal,1==k.proType?(j=parseFloat(a(".jsNum").html()),a(".hjNum").html(f.total_price.toFixed(2)),a(".jsNum").html((j+parseFloat(parseFloat(h.$container.attr("origin_price"))-parseFloat(h.$container.attr("price")))*i).toFixed(2))):(j=parseFloat(a(".jsNum0").html()),a(".hjNum0").html(f.sea_total_price.toFixed(2)),a(".jsNum0").html((j+parseFloat(parseFloat(h.$container.attr("origin_price"))-parseFloat(h.$container.attr("price")))*i).toFixed(2))),0==g&&(1==a(h.$container).closest(".cart-item").find(".recom").length?a(h.$container).closest(".cart-item").remove():a(h.$container).closest(".recom").remove()));1==k.proType&&a("#products .recom").length<1?(b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>')):0==k.proType&&a("#sea_products .recom").length<1&&(b=c.getBoundingClientRect().width,a(".container").removeClass("heiauto"),a("#sea_products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+b*e+"px;height:"+1.7*b*e+'px"><a class="go-index" href="http://h5.ve.cn"></a></div></div>')),console.log(f)},error:function(b){console.log(b),"库存不足"==b.desc&&(a(h.$inputNum).val(a(h.$inputNum).attr("valueAsNumber")-1),h.$minus.removeClass("minus-disabled"),h.$add.addClass("add-disabled"),lib.notification.alert(b.desc,function(){this.hide()}).show())},complete:function(){k.del_isAjax=!1}}))}};a(function(){f.init()})}(Zepto,window.Global||(window.Global={}));