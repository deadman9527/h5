!function(a){var b=window.navigator.userAgent.toLowerCase();SEMURL=b.match(/MobileVecn/i)?!1:!0,Global.formatImgSrc=function(a){var b=a.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return b?"http"+b[1]+".jpg":a},Global.formatTitleLink=function(a,b,c){var d="http://"+location.host,e=b?"&brandId="+b:"",f="detail.html?productId="+a+e,g=c?c:"",h=d+"/"+g+"goods-"+a+".html?productId="+a+e,i=SEMURL?h:f;return i},Global.formatLink=function(a,b){var c="http://"+location.host,d=a?"?brandId="+a:"",e="list.html?brandId="+a,f=b?b:"",g=c+"/"+f+"brandcate-"+a+".html"+d,h=SEMURL?g:e;return h};var c,d=document.documentElement,e={init:function(){var b=new lib.httpurl(location.href),e=b.params,f=e.title?decodeURIComponent(e.title):"商品详情";return c=d.getBoundingClientRect().width,this.productId=e.productId,this.brandId=e.brandId||null,this.isBuy=!1,this.nosuxing=!1,lib.h5log.log(["setCustomVariable",3,"productId",e.productId,"page"]),"goods_detail"==e.act?(this.renderContent(2),lib.lazyload.init(),void a("body").show()):(e.attr&&e.cartNum&&(this.attr=e.attr,this.cartNum=e.cartNum,this.cartType=e.type||null,this.renderCart()),document.title=f,this.topbar=new ctrl.topBar({isIndex:!1,title:f,topHome:!0}),this.render(),this.getTurnOff(),this.addEvent(),lib.lazyload.init({loadHidden:!1}),void new lib.goTop({position:{bottom:65}}))},checkUrl:function(){if(SEMURL&&location.href.indexOf("/goods-")<0){var a=this;if(a.urlAjax)return;a.urlAjax=!0,lib.api.get({api:{c:"alias",a:""},data:{productId:this.productId,brandId:this.brandId},success:function(b){var c="http://"+location.host,d=a.brandId?"?brandId="+a.brandId:"";location.href=c+"/"+b.alias+"goods-"+a.productId+".html"+d},error:function(a){console.log(a)},complete:function(){a.urlAjax=!1}})}},addEvent:function(){var b=!1;a(".middle-top li").on("click",function(){"2"==a(this).find("span").attr("po")?(a(".pro-love").show(),a(".pro-detail").hide(),b||lib.lazyload.trigger(),b=!0):(a(".pro-detail").show(),a(".pro-love").hide()),a(".middle-top span").removeClass("hover"),a(this).find("span").addClass("hover")})},getTurnOff:function(){var b=this;a.getJSON("http://act.ve.cn/data/switch.json",function(a){b.turnOff=a.turnoff})},renderLove:function(){try{var b=this,c=a("#love-items"),d=a("#tpl-loveitems").html();c.append(_.template(d)({itemList:b.data.brand.data,brandId:b.brandId,alias:b.data.alias?b.data.alias:""})),lib.lazyload.trigger()}catch(e){}},render:function(){var b=this;b.isAjax||(b.isAjax=!0,lib.api.get({api:{c:"deal",a:"detail"},data:{productId:this.productId,brandId:this.brandId},success:function(c){a("body").show(),c.products.is_sea_label&&(b.cartType=c.products.is_sea_label),b.data=c,b.renderContent(1),b.renderSlide(c.products.images),b.renderItems([c]);var d=c.products.comment_lists?c.products.comment_lists:null;null!=d&&b.renderMask(d),b.renderAct(c),b.renderTime(c);try{c.products.brief.length<1&&a(".recom").hide()}catch(e){console.log("no brief")}if(c.brand){c.brand.data?b.renderLove():a(".middle-top").remove(),a(".middle-top").fixedsticky();var f=window.navigator.userAgent.toLowerCase();f.match(/MobileVecn/i)&&a(".middle-top").css("top","0px"),b.renderBrands()}else a(".pro-love").remove(),a(".middle-top").remove(),a("#brands").remove();if(parseInt(c.products.end_time)<parseInt(Date.parse(new Date)/1e3)||parseInt(c.products.begin_time)>parseInt(Date.parse(new Date)/1e3)||c.products.is_stock<=0)return a(".main").prepend('<p class="no-item">宝贝已被抢光</p>'),a("#buy-now").html(" 加入购物车"),a("#buy-now").addClass("pro-nobuy"),a("#buy").html(" 立即购买"),void a("#buy").addClass("pro-nobuy");if(b.turnOff)a("#buy").hide(),a("#buy-now").removeClass("pro-buy").addClass("pro-buy-red"),b.renderSku(c);else if(c.products)if(1==c.products.is_sea_label)a("#buy").hide(),a("#buy-now").removeClass("pro-buy").addClass("pro-buy-red"),1==c.products.suxing[0].xxsx.length?(a(".pro-buy").removeClass("sku-trigger"),b.cartNum=1,a("#sku-size").val(c.products.suxing[0].xxsx[0].id),b.attr=a("#sku-size").val(),a("#buy-now").on("click",function(){a(this).hasClass("pro-nobuy")||b.renderCart()})):b.renderSku(c);else if(c.products.suxing&&c.products.suxing[0])if(1==c.products.suxing[0].xxsx.length)a(".pro-buy").removeClass("sku-trigger"),b.cartNum=1,a("#sku-size").val(c.products.suxing[0].xxsx[0].id),b.attr=a("#sku-size").val(),a("#buy").on("click",function(){b.isBuy=!0,a(this).hasClass("pro-nobuy")||b.renderCart()}),a("#buy-now").on("click",function(){a(this).hasClass("pro-nobuy")||b.renderCart()});else{var g=!0;g=a("#buy").hasClass("pro-nobuy")?!1:!0,g=a("#buy-now").hasClass("pro-nobuy")?!1:!0,a("#buy").on("click",function(){b.isBuy=!0}),a("#buy-now").on("click",function(){b.isBuy=!1}),g&&b.renderSku(c)}else c.products.suxing||(a(".pro-buy").removeClass("sku-trigger"),b.cartNum=1,b.nosuxing=!0,a("#buy").on("click",function(){b.isBuy=!0,a(this).hasClass("pro-nobuy")||b.renderCart()}),a("#buy-now").on("click",function(){a(this).hasClass("pro-nobuy")||b.renderCart()}));lib.lazyload.trigger()},error:function(b){a("body").show(),a(".container").css("height","100%"),a(".container").css("margin-top","0px"),a(".container").css("padding-top","40px"),a(".container").html("<p class='no-product no-img'></p><p class='no-product'><span>该商品不存在</span><br /><span class='backIndex'><a href=\"index.html\">回到首页</a></span></p>"),console.log(b)},complete:function(){b.isAjax=!1}}))},renderBrands:function(){var b=this,c=a("#brands"),d=a("#tpl-brands").html();c.append(_.template(d)({itemList:[b.data.brand],alias:b.data.alias?b.data.alias:""}))},renderTime:function(b){if(parseInt(b.products.end_time)>parseInt(Date.parse(new Date)/1e3)){{lib.countdown({endDate:"+"+(parseInt(b.products.end_time)-parseInt(Date.parse(new Date)/1e3)).toString(),stringFormatter:"d天 hh小时mm分ss秒",onUpdate:function(b){a(".timeover").html("还剩"+b.stringValue)},onEnd:function(){console.log("cd2 ended")}}).start()}a(".timeover").show()}else a(".timeover").remove()},renderAct:function(b){if("1"==b.products.free_ship?(a(".payoffall").show(),a("#by").append('<p><span class="by">包邮</span> <span class="active-desc">该商品包邮</span></p>')):a("#by").hide(),"undefined"!=typeof b.promotions){var c=b.promotions,d="",e="",f="";if(c.length>0){a(".payoffall").show();for(var g=0;g<c.length;g++)"discount"==c[g].type&&(d=c[g].title+"，"),"gift"==c[g].type&&(e+=c[g].title+"，",c[g].goods_gift&&(f+="<ul>",a(c[g].goods_gift).each(function(){f+='<li><p><img width="50" src="'+this.gift_minpic+'" /><a href="detail.html?productId='+this.goods_id+'">'+this.goods_name+"</a></p> </li>"}),f+="</ul>"));d=d.substring(0,d.length-1),e=e.substring(0,e.length-1),""!=d?a("#mj").append('<p><span class="mj">满减</span> <span class="active-desc">'+d+"</span></p>"):a("#mj").hide(),""!=e?a("#mz").append('<p><span class="mz">满赠</span> <span class="active-desc">'+e+"</span></p>"):a("#mz").hide(),f?a("#gift").html(f):a("#gift").hide()}else"0"==b.products.free_ship&&a(".payoffall").hide()}else"0"==b.products.free_ship&&a(".payoffall").remove()},renderContent:function(b){var c=this;c.con_isAjax||(c.con_isAjax=!0,lib.api.get({api:{c:"deal",a:"detail_content"},data:{productId:this.productId},success:function(d){var e=d.data.description?d.data.description:"";e=e.replace(/src=".\/public/g,'src="http://img.ve.cn/public'),e=e.replace(/http:\/\/img.ve.chttp/g,"http:"),e=e.replace(/src/g,'class="lazy" src="http://h5.ve.cn/assets/img/cart_img_black_640x253.png" dataimg'),1==b?c.data&&c.data.brand&&!c.data.brand.data?(a(".pro-detail").prepend("<h1>图文详情</h1>"+e),a(".pro-detail").css("margin-top","5px")):a(".pro-detail").prepend(e):2==b&&a("body").html('<div class="c-detail">'+e+"</div>"),setTimeout(function(){lib.lazyload.trigger()},400)},error:function(){2==b&&a("body").html("暂时没有描述"),c.renderError("network")},complete:function(){c.con_isAjax=!1}}))},renderSku:function(b){var c=this;this.evaDialog=new lib.Dialog({boxClass:"#sku-dialog",triggerClass:".sku-trigger",onShow:function(){setTimeout(function(){a(".sku-dialog-box").css("-webkit-transform","translateY(0%)")},100),a(".topbar").hide(),a("body").css("padding-top","0px"),a(".ve-gotop").hide()},onHide:function(){a(".topbar").show(),a("body").css("padding-top","40px"),a(".ve-gotop").show()}}),a(".sku-cancel").on("click",function(){a(".sku-dialog-box").css("-webkit-transform","translateY(100%)"),setTimeout(function(){a("#sku-dialog").hide(),a(".topbar").show(),a("body").css("padding-top","40px")},300)});var d=a("#dia-sku-top"),e=a("#tpl-dia-sku-top").html();d.prepend(_.template(e)({itemList:[b.products]}));var f=0==parseInt(b.products.user_min_bought)?1:b.products.user_min_bought,g=0==parseInt(b.products.user_max_bought)?999:b.products.user_max_bought;if(c.number=new ctrl.number({el:"#J_Num1",step:1,quantity:f,min:f,max:g}),null!=b.products.suxing){var h=a("#dia-sku-size"),i=a("#tpl-dia-sku-size").html();h.html(_.template(i)({itemList:b.products.suxing[0].xxsx})),b.products.suxing[0].xxsx.length>=1&&(a(".sku-size span:eq(0)").attr("select","true"),a(".sku-size span:eq(0)").css("border","1px solid #ff3862"),a(".sku-size span:eq(0)").css("color","#ff3862"),a("#sku-size").val(b.products.suxing[0].xxsx[0].id))}a(".sku-size span").click(function(){"false"==a(this).attr("select")?(a("#sku-size").val(a(this).attr("barcode")),a(".sku-size span").attr("select","false"),a(".sku-size span").css("border","1px solid #333333"),a(".sku-size span").css("color","#333333"),a(this).attr("select","true"),a(this).css("border","1px solid #ff3862"),a(this).css("color","#ff3862"),a("#sku-bigpri").html(parseFloat(a(this).attr("current_price")))):(a("#sku-size").val(""),a(".sku-size span").css("border","1px solid #333333"),a(".sku-size span").css("color","#333333"),a(".sku-size span").attr("select","false"))}),a(".pro-sku-foot span").click(function(){c.renderCart()})},renderMask:function(a){var b=this;this.evaDialog=new lib.Dialog({boxClass:"#dialog",triggerClass:".evaimg-trigger",hideClass:"#sliderDiv",onShow:function(){b.maskSlider(this.obj,a)}})},maskSlider:function(b,d){if(this.maskslider=null,!this.maskslider){a(".slider-box2").html('<div class="slider-outer"><div id="slides2" class="slider-wrap"> </div></div><div class="slider-status2"></div>'),a(".dialog-box").css("width",.9*c+"px");var e=a("#slides2"),f=a("#tpl-masklides").html();e.html(_.template(f)({itemList:d[a(b).attr("itemid")].imgurl,w:.9*c})),this.maskslider=new lib.Slider(".slider-box2",{trigger:".slider-status2"})}this.maskslider.slideTo(a(b).attr("i")),lib.lazyload.trigger()},renderItems:function(b){var c=a("#items"),d=a("#tpl-item").html();c.append(_.template(d)({itemList:b}));var e=a("#recom-content"),f=a("#tpl-recom-content").html();e.html(_.template(f)({itemList:b}))},renderSlide:function(b){var d=a("#slides"),e=a("#tpl-slides").html();d.append(_.template(e)({itemList:b,w:c})),this.slider=new lib.Slider(".slider-box",{loop:!0,play:!0,trigger:".slider-status"}),a(".slider-box").append('<div class="timeover"></div>'),this.data&&""!=this.data.supplier&&a(".slider-box").append(this.data.supplier.indexOf("保税")>=0?'<div class="supplier">'+this.data.supplier+"</div>":'<div class="supplier2">'+this.data.supplier+"</div>")},renderCart:function(){lib.login.isLogin()||lib.storage.set("accessToken","");var b,c;if(this.nosuxing)b="",c=this.cartNum;else if(this.attr&&this.cartNum)b=this.attr,c=this.cartNum;else{if(null!=this.data.products.attr&&""==a("#sku-size").val())return void lib.notification.alert("请选择尺寸",function(){this.hide()}).show();b=a("#sku-size").val(),c=a(this.number.$inputNum).attr("valueAsNumber")}var d=this;if(!d.skusure_isAjax){d.goodsNumber=this.cartNum?this.cartNum:a(this.number.$inputNum).attr("valueAsNumber"),d.skusure_isAjax=!0;var e={attr:b,user_min_bought:null,free_ship:null,user_max_bought:null,img:null,imgurl:null,isSelect:!0,suxing:null,itemid:null,nofree_ship_info:null,sourceId:null,source:null,settle:null,promotions:null,product_name:null,productid:this.productId,price:0,origin_price:0,position:0,num:c,is_stock:0,gift:!1,decrease:!1};lib.api.get(this.isBuy?{api:{c:"shoping",a:"addtocart"},data:{json:"["+JSON.stringify(e)+"]",buy_now:1,accessToken:lib.storage.get("accessToken")},success:function(a){lib.h5log.log(["setCustomVariable",3,"productId",d.productId,"page"],["setCustomVariable",4,"goodsNumber",d.goodsNumber,"page"]),null!=b&&c&&(lib.login.isLogin()?location.href=0==d.data.products.is_sea_label?"order-confirm.html":"order-confirm.html?proType=1":0==d.data.products.is_sea_label?setTimeout(function(){location.href="direct-order-confirm.html?cartId="+a.cart_id},50):setTimeout(function(){location.href="direct-order-confirm.html?proType=1&cartId="+a.cart_id},50))},error:function(a){if(a&&""!=a.desc){var b=a.desc;alert(b)}else b="服务器开小差啦"},complete:function(){d.skusure_isAjax=!1}}:{api:{c:"shoping",a:"addtocart"},data:{json:"["+JSON.stringify(e)+"]",accessToken:lib.storage.get("accessToken"),buy_now:0},success:function(){if(lib.h5log.log(["setCustomVariable",3,"productId",d.productId,"page"],["setCustomVariable",4,"goodsNumber",d.goodsNumber,"page"]),e.attr||e.num){a(".sku-dialog-box").css("-webkit-transform","translateY(100%)"),setTimeout(function(){a("#sku-dialog").css("display","none")},400),a(".topbar").show(),a("body").css("padding-top","40px");var b=lib.notification.confirm("已成功加入购物车，是否去结算？","",function(a,b){window.location=b?0==d.data.products.is_sea_label?"cart.html":"cart.html?type=2":d.data.brand&&d.data.alias?Global.formatLink(d.data.brand.brandId,d.data.alias):"index.html",this.hide()},{okText:"去结算",noText:"继续逛"});b.show()}},error:function(a){if(a&&""!=a.desc)var b=a.desc;else b="服务器开小差啦";lib.notification.alert(b,function(){this.hide()},{okText:"确定"}).show()},complete:function(){d.skusure_isAjax=!1}})}},renderError:function(a){switch(a){case"param":this.showTip("参数请求错误");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，数据为空")}},showTip:function(b){var c=a("#info-tip");c.html(b).show()},hideTip:function(b){var c=a("#info-tip");b?(c.html("加载已完毕").show(),setTimeout(function(){c.hide()},5e3)):c.hide()}};a(function(){e.init()})}(Zepto,window.Global||(window.Global={}));