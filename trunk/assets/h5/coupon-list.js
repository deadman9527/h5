!function(a){var b={init:function(){var a=new lib.httpurl(location.href),b=a.params,c=b.title?decodeURIComponent(b.title):"优惠券";document.title=c,new ctrl.topBar({isIndex:!1,title:c}),this.is_select=b.is_select||0,this.render(),this.addEvents(),new lib.goTop},addEvents:function(){var b=this;a(".activate-btn").on("click",function(){var c=a(".input").val();if(c)lib.api.get({needLogin:!0,api:{c:"Coupons",a:"activateCoupon"},data:{coupon_code:c},success:function(c){console.log(c),a("#coupons").empty(),b.render()},error:function(a){var b=lib.notification.alert(a.desc,function(){this.hide()});b.show()},complete:function(){}});else{var d=lib.notification.alert("请输入优惠券码",function(){this.hide()});d.show()}})},render:function(){var a=this;a.isAjax||(a.isAjax=!0,lib.api.get({needLogin:!0,api:{c:"Coupons",a:"getUserConpon"},data:{},success:function(b){console.log(b),a.renderItems(b)},error:function(a){var b=lib.notification.alert(a.desc,function(){this.hide()},{useTap:!0});b.show()},complete:function(){a.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(b){var c=[];c[0]=[],c[1]=[],c[2]=[];for(var d in b.data.coupon)switch(console.log(b.data.coupon[d]),b.data.coupon[d].useable){case 1:console.log(1),console.log(c),c[0].push(b.data.coupon[d]);break;case 2:console.log(2),c[1].push(b.data.coupon[d]);break;default:console.log(3),c[2].push(b.data.coupon[d])}console.log(c);var e=a("#coupons"),f=a("#tpl-coupon").html();e.append(_.template(f)({couponList:c}))},renderError:function(a){switch(a){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(b){var c=a(".info-tip");c.html(b).show()}};a(function(){b.init()})}(Zepto,window.Global||(window.Global={}));