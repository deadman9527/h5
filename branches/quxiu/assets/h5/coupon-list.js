!function(o){var n={init:function(){var o=new lib.httpurl(location.href),n=o.params,t=n.title?decodeURIComponent(n.title):"优惠券";document.title=t,new ctrl.topBar({isIndex:!1,title:t}),this.is_select=n.is_select||0,this.render(),this.addEvents(),new lib.goTop},addEvents:function(){var n=this;o(".activate-btn").on("click",function(){var t=o(".input").val();if(t)lib.api.get({needLogin:!0,api:{c:"Coupons",a:"activateCoupon"},data:{coupon_code:t},success:function(t){console.log(t),o("#coupons").empty(),n.render()},error:function(o){var n=lib.notification.alert(o.desc,function(){this.hide()});n.show()},complete:function(){}});else{var e=lib.notification.alert("请输入优惠券码",function(){this.hide()});e.show()}})},render:function(){var o=this;o.isAjax||(o.isAjax=!0,lib.api.get({needLogin:!0,api:{c:"Coupons",a:"getUserConpon"},data:{},success:function(n){console.log(n),o.renderItems(n)},error:function(o){var n=lib.notification.alert(o.desc,function(){this.hide()},{useTap:!0});n.show()},complete:function(){o.isAjax=!1}}))},checkNeedScroll:function(){return!this.is_have},renderItems:function(n){var t=[];t[0]=[],t[1]=[],t[2]=[];for(var e in n.data.coupon)switch(console.log(n.data.coupon[e]),n.data.coupon[e].useable){case 1:console.log(1),console.log(t),t[0].push(n.data.coupon[e]);break;case 2:console.log(2),t[1].push(n.data.coupon[e]);break;default:console.log(3),t[2].push(n.data.coupon[e])}console.log(t);var i=o("#coupons"),a=o("#tpl-coupon").html();i.append(_.template(a)({couponList:t}))},renderError:function(o){switch(o){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(n){var t=o(".info-tip");t.html(n).show()}};o(function(){n.init()})}(Zepto,window.Global||(window.Global={}));