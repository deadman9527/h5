!function(e){var t={init:function(){var e=new lib.httpurl(location.href),t=e.params;this.proType=parseInt(t.proType)||0,this.addEvents(),this.topbar=new ctrl.topBar({isIndex:!1})},addEvents:function(){var t=this;e("#submit").on("click",function(){t.submit()}),e("#get-code").on("click",function(){t.getCode()})},submit:function(){var e=this;e.isAjax||this.verify()&&(e.isAjax=!0,lib.md5&&(this.password=lib.md5(this.password)),lib.api.get({api:{c:"FreeUser",a:"free_register"},data:{phone:this.mobile,verify_code:this.code,app:"h5"},success:function(t){console.log(t),t.user.area=t.user.area?t.user.area:{},t.user.area.phone=e.mobile,lib.storage.set("editAddressData",t.user.area),lib.login.login(t,"address-add.html?isDirect=1&proType="+e.proType)},error:function(e){e&&e.desc&&alert(e.desc)},complete:function(){setTimeout(function(){e.isAjax=!1},1e3)}}),lib.storage.get("register_r")&&lib.storage.set("register_r",null))},getCode:function(){var e=this;1!=e.isAjaxGetcode&&this.verify("tel")&&(e.isAjaxGetcode=!0,lib.api.get({api:{c:"sms",a:"sendMsg"},data:{mobile:this.mobile,status:"free_user"},success:function(t){console.log(t),alert("发送成功"),e.timerClock("#get-code")},error:function(e){console.log(e),alert(e&&e.desc?e.desc:"请求验证码失败")},complete:function(){setTimeout(function(){e.isAjaxGetcode=!1},1e3)}}))},verify:function(t){return this.mobile=e("#tel").val(),this.code=e("#code").val(),0==arguments.length?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?/^[0-9]{6}$/.test(this.code)?!0:(alert("验证码不正确！"),!1):(alert("手机号码不正确！"),!1):1==arguments.length&&(t="tel")?/^1(3[0-9]|5[012356789]|7[678]|8[0-9]|4[57])[0-9]{8}$/.test(this.mobile)?!0:(alert("手机号码不正确！"),!1):void 0},timerClock:function(t){var i=this,s=60;i.verifyFlag=1,e(t).addClass("getcode-icon").html("剩余 "+s+" 秒"),e(t).off();var o=setInterval(function(){1>=s?(clearInterval(o),i.verifyFlag=0,e(t).removeClass("getcode-icon").html("获取验证码"),e(t).on("click",function(){i.getCode()})):(s--,e(t).html("剩余 "+s+" 秒"))},1e3)}};e(function(){t.init()})}(Zepto);