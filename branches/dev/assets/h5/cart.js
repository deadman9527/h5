!function(t){var e,i=document.documentElement,a=t(window).height();console.log(a);var r=500>a?.45:.5625,o={init:function(){lib.login.isLogin()||lib.storage.set("accessToken","");var e=new lib.httpurl(location.href),i=e.params,a=i.title?decodeURIComponent(i.title):"购物车";document.title=a,this.topbar=new ctrl.topBar({isIndex:!1,title:a}),this.bottombar=new ctrl.bottomBar({hoverIndex:2,showBottom:!0}),this.proType=1,this.render(),this.choose=2==i.type?2:null,this.renderContent();var r=window.navigator.userAgent.toLowerCase();return r.match(/MicroMessenger/i)||r.match(/MobileVecn/i)?void t(".container").css("padding","0"):void new lib.goTop({position:{bottom:60}})},"switch":function(){var e=this;t.get("http://act.quxiu.me/data/switch.json",function(i){e.switch=i,(i.turnoff||lib.login.isLogin())&&t("#products .cart-bottom .cart-t a").attr("href","order-confirm.html")})},addEvent:function(){var e=this;t("#btn-pro").click(function(){t("#btn-sea").removeClass("hover"),t(this).addClass("hover"),e.proType=1,t("#products").show(),t("#sea_products").hide(),t("#products .cart-item").length<1?t(".container").removeClass("heiauto"):t(".container").addClass("heiauto")}),t("#btn-sea").click(function(){t("#btn-pro").removeClass("hover"),t(this).addClass("hover"),e.proType=0,t("#products").hide(),t("#sea_products").show(),t("#sea_products .cart-item").length<1?t(".container").removeClass("heiauto"):t(".container").addClass("heiauto")})},render:function(){},renderContent:function(){var a=this;a.cart_isAjax||(a.cart_isAjax=!0,lib.api.get({api:{c:"shoping",a:"get_User_Cart"},data:{accessToken:lib.storage.get("accessToken")},success:function(o){if(console.log(o),o.products&&o.products[0])for(var s=o.products.length-1;s>=0;s--)o.products[s].orders&&o.products[s].orders[0]||o.products.splice(s,1);a.editData=o;var n=t("#mainItem"),c=t("#tpl-mainItem").html();n.prepend(_.template(c)({itemList:[o]})),new ctrl.number({el:".J_Num1",step:1,quantity:1,min:0,max:3,cart:!0,onAdd:function(){a.renderDel(this,"add")},onMinus:function(){a.renderDel(this,"minus")},onBlur:function(){a.renderDel(this,"blur")}}),t(".delete-cart").click(function(){a.renderDel(this,"del")}),a.addEvent(),o.products||o.sea_products?(!o.products||o.products.length<1?(e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>')):(!o.sea_products||o.sea_products.length<1)&&(e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#sea_products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>')),1==a.proType&&(!o.products||o.products.length<=0)&&o.sea_products&&o.sea_products.length>0&&(t("#btn-pro").removeClass("hover"),t("#btn-sea").addClass("hover"),a.proType=0,t("#products").hide(),t("#sea_products").show()),1==a.proType&&(!o.products||o.products.length>0)&&t(".container").addClass("heiauto"),0==a.proType&&o.sea_products&&o.sea_products.length>0&&t(".container").addClass("heiauto"),t("#cart-sea").click(function(){a.editData&&!a.editData.is_sea_order?lib.notification.alert(a.editData.sea_limit_message,function(){this.hide()}).show():window.location.href=a.switch.turnoff?"order-confirm.html?proType=1":lib.login.isLogin()?"order-confirm.html?proType=1":"direct-order-confirm.html?proType=1"})):(e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#mainItem").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>')),2==a.choose&&(t("#btn-pro").removeClass("hover"),t("#btn-sea").addClass("hover"),a.proType=0,t("#products").hide(),t("#sea_products").show(),t("#sea_products .cart-item").length<1?t(".container").removeClass("heiauto"):t(".container").addClass("heiauto")),a.switch()},error:function(a){e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#mainItem").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>'),console.log(a,a.desc)},complete:function(){a.cart_isAjax=!1}}))},renderDel:function(e,i){var a=this,r=0,o=0;"del"==i?(r=0,o=t(e).attr("itemid")):"add"==i?(r=t(e.$inputNum).attr("valueAsNumber")+1,o=e.itemid):"minus"==i?(r=t(e.$inputNum).attr("valueAsNumber")-1,r>0&&(o=e.itemid)):"blur"==i&&(r=t(e.$inputNum).attr("valueAsNumber"),o=e.itemid);var s=t(e.$container).attr("min")-1||0;if(s>=r){var n=lib.notification.confirm("确认删除","",function(r,s){s?("minus"==i&&(o=e.itemid),a.renderConDel(i,o,0,e)):"minus"==i?0==parseInt(t(e.$inputNum).val())&&t(e.$inputNum).val(t(e.$inputNum).attr("valueAsNumber")+1):t(e.$inputNum).val(e.lastFocusVal),this.hide()},"{background:#fff}");n.show()}else a.renderConDel(i,o,r,e)},renderConDel:function(a,o,s,n){var c=1;"add"==a||"minus"==a?(n.$add.addClass("add-disabled"),n.$minus.addClass("minus-disabled"),c="add"==a?1:-1):"blur"==a&&(t(n.$inputNum).attr("valueAsNumber")>=parseInt(t(n.$container).attr("max"))&&(s=parseInt(t(n.$container).attr("max"))),t(n.$inputNum).attr("valueAsNumber")<=parseInt(t(n.$container).attr("min"))&&(s=parseInt(t(n.$container).attr("min"))));var d={num:s,v:"1.6",itemid:o},l=this;l.del_isAjax||(l.del_isAjax=!0,lib.api.get({api:{c:"shoping",a:"cart_edit_new"},data:{json:"["+JSON.stringify(d)+"]",accessToken:lib.storage.get("accessToken")},success:function(o){l.editData=o;var d;if("del"==a){var u=t(t(n).closest(".recom")),m=u.find(".J_Num1 input").attr("valueAsNumber")*(parseFloat(u.find(".J_Num1").attr("origin_price"))-parseFloat(u.find(".J_Num1").attr("price")));1==t(n).closest(".cart-item").find(".recom").length?t(n).closest(".cart-item").remove():t(n).closest(".recom").remove(),1==l.proType?(t(".hjNum").html(o.total_price.toFixed(2)),d=parseFloat(t(".jsNum").html()),t(".jsNum").html((d-m.toFixed(2)).toFixed(2))):(t(".hjNum0").html(o.sea_total_price.toFixed(2)),d=parseFloat(t(".jsNum0").html()),t(".jsNum0").html((d-m.toFixed(2)).toFixed(2)))}else"add"==a||"minus"==a?(t(n.$inputNum).attr("valueAsNumber")<parseInt(t(n.$container).attr("max"))&&n.$add.removeClass("add-disabled"),t(n.$inputNum).attr("valueAsNumber")>parseInt(t(n.$container).attr("min"))&&n.$minus.removeClass("minus-disabled"),1==l.proType?(d=parseFloat(t(".jsNum").html()),t(".hjNum").html(o.total_price.toFixed(2)),t(".jsNum").html((d+parseFloat(parseFloat(n.$container.attr("origin_price"))-parseFloat(n.$container.attr("price"))).toFixed(2)*c).toFixed(2))):(d=parseFloat(t(".jsNum0").html()),t(".hjNum0").html(o.sea_total_price.toFixed(2)),t(".jsNum0").html((d+parseFloat(parseFloat(n.$container.attr("origin_price"))-parseFloat(n.$container.attr("price"))).toFixed(2)*c).toFixed(2))),0==s&&(1==t(n.$container).closest(".cart-item").find(".recom").length?t(n.$container).closest(".cart-item").remove():t(n.$container).closest(".recom").remove())):"blur"==a&&(c=t(n.$inputNum).attr("valueAsNumber")-n.lastFocusVal,1==l.proType?(d=parseFloat(t(".jsNum").html()),t(".hjNum").html(o.total_price.toFixed(2)),t(".jsNum").html((d+parseFloat(parseFloat(n.$container.attr("origin_price"))-parseFloat(n.$container.attr("price")))*c).toFixed(2))):(d=parseFloat(t(".jsNum0").html()),t(".hjNum0").html(o.sea_total_price.toFixed(2)),t(".jsNum0").html((d+parseFloat(parseFloat(n.$container.attr("origin_price"))-parseFloat(n.$container.attr("price")))*c).toFixed(2))),0==s&&(1==t(n.$container).closest(".cart-item").find(".recom").length?t(n.$container).closest(".cart-item").remove():t(n.$container).closest(".recom").remove()));1==l.proType&&t("#products .recom").length<1?(e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>')):0==l.proType&&t("#sea_products .recom").length<1&&(e=i.getBoundingClientRect().width,t(".container").removeClass("heiauto"),t("#sea_products").html('<div class="cart-outer"><div class="cart-inner" style="width:'+e*r+"px;height:"+1.7*e*r+'px"><a class="go-index" href="http://h5.quxiu.me"></a></div></div>')),console.log(o)},error:function(e){console.log(e),"库存不足"==e.desc&&(t(n.$inputNum).val(t(n.$inputNum).attr("valueAsNumber")-1),n.$minus.removeClass("minus-disabled"),n.$add.addClass("add-disabled"),lib.notification.alert(e.desc,function(){this.hide()}).show())},complete:function(){l.del_isAjax=!1}}))}};t(function(){o.init()})}(Zepto,window.Global||(window.Global={}));