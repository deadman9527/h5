!function(e){Global.formatImgSrc=function(e){if(!e)return"http://h5.quxiu.me/assets/img/cart_img_black_640x253.png";var n=e.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return n?"http"+n[1]+".jpg":e},Global.timeFormat=function(e){var n=new Date(1e3*e),t=n.getFullYear(n),o=n.getMonth(n)+1,i=n.getDate(n),r=n.getHours(n),a=n.getMinutes(n),s=n.getSeconds(n);return t+"-"+o+"-"+i+" "+r+":"+a+":"+s};var n={init:function(){var e=new lib.httpurl(location.href),n=e.params,t=n.title?decodeURIComponent(n.title):"订单详情";document.title=t,new ctrl.topBar({isIndex:!1,title:t}),this.orderSn=n.orderSn||0,this.fromUseless=n.fromUseless||0,lib.lazyload.init(),this.addEvents(),this.render(),new lib.goTop},addEvents:function(){e(".radio").on("click",function(){if(!e(this).hasClass("radio-active")){var n=e(this).attr("name");e(".radio[name="+n+"]").removeClass("radio-active"),e(this).addClass("radio-active")}})},addEventsAction:function(){var n=this;e(".cancel").on("click",function(){var e=lib.notification.confirm("您确定要取消这个订单吗？","",function(e,t){t&&lib.api.get({api:{c:"order",a:"cancelOrder"},needLogin:!0,data:{order_sn:n.orderSn},success:function(e){console.log(e);var n=lib.notification.alert(e.desc,function(){this.hide(),history.go(-1)});n.show()},error:function(e){var n=lib.notification.alert(e.desc,function(){this.hide()});n.show()},complete:function(){n.isAjax=!1}}),this.hide()});e.show()}),e(".delete").on("click",function(){var e=lib.notification.confirm("您确定要删除这个订单吗？","",function(e,t){t&&lib.api.get({api:{c:"order",a:"delorder"},needLogin:!0,data:{order_sn:n.orderSn},success:function(e){console.log(e);var n=lib.notification.alert(e.desc,function(){this.hide(),window.location.href="order-list.html"});n.show()},error:function(e){var n=lib.notification.alert(e.desc,function(){this.hide()});n.show()},complete:function(){n.isAjax=!1}}),this.hide()});e.show()}),e(".pay").on("click",function(){if(!n.isAjax){var e=window.navigator.userAgent.toLowerCase(),t=20,o=null;e.match(/MicroMessenger/i)?(t=25,o="http://pay.api.ve.cn"):t=20,lib.api.get({api:{c:"pay",a:"payOrder"},needLogin:!0,apiUrl:o,data:{pay_type:t,in_app:0,order_sn:n.orderSn},success:function(e){console.log(e),window.location.href=e.html_url},error:function(e){console.log(e);var n=lib.notification.alert(e.desc,function(){this.hide()});n.show()},complete:function(){n.isAjax=!1}})}}),e(".logistic").on("click",function(){window.location.href="logistics.html?order_sn="+n.orderSn})},render:function(){if(!lib.login.isLogin())return void lib.login.goLogin();var e=this;e.isAjax||(e.isAjax=!0,lib.api.get({api:{c:"order",a:"odetails"},needLogin:!0,data:{order_sn:e.orderSn},success:function(n){console.log(n),n.order?(e.renderAddress(n.order),e.renderItems(n.order),e.renderSum(n.order),e.renderOrder(n.order),e.renderAction(n.order),e.addEventsAction(),e.discount()):e.renderError("empty")},error:function(e){var n=lib.notification.alert(e.desc,function(){this.hide()},{useTap:!0});n.show()},complete:function(){e.isAjax=!1}}))},discount:function(){e(".order-discount")[0]&&e(".order-discount span").each(function(n,t){var o=parseInt(e(t).attr("data"));setInterval(function(){if(o--,0>=o)window.location.reload();else{var n=Math.floor(o/60),i=o%60;e(t).text((n>9?n:"0"+n)+"分"+(i>9?i:"0"+i)+"秒")}},1e3)})},checkNeedScroll:function(){return!this.is_have},renderAddress:function(n){var t=e("#address"),o=e("#tpl-address").html();t.prepend(_.template(o)({order:n}))},renderItems:function(n){var t=e(".goods-container"),o=e("#tpl-goods").html();t.append(_.template(o)({order:n})),lib.lazyload.trigger()},renderSum:function(n){var t=e(".goods-sum"),o=e("#tpl-sum").html();t.append(_.template(o)({order:n}))},renderOrder:function(n){var t=e(".information-content"),o=e("#tpl-order-info").html();t.prepend(_.template(o)({order:n,fromUseless:this.fromUseless}))},renderAction:function(n){var t=e(".main"),o=e("#tpl-action").html();t.append(_.template(o)({order:n}))},renderError:function(e){switch(e){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(n){var t=e(".info-tip");t.html(n).show()}};e(function(){n.init()})}(Zepto,window.Global||(window.Global={}));