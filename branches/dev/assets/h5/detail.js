!function(t){var s=window.navigator.userAgent.toLowerCase();SEMURL=s.match(/MobileVecn/i)?!1:!0,Global.formatImgSrc=function(t){var s=t.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return s?"http"+s[1]+".jpg":t},Global.formatTitleLink=function(t,s,e){var i="http://"+location.host,a=s?"&brandId="+s:"",o="detail.html?productId="+t+a,r=e?e:"",n=i+"/"+r+"goods-"+t+".html?productId="+t+a,d=SEMURL?n:o;return d},Global.formatLink=function(t,s){var e="http://"+location.host,i=t?"?brandId="+t:"",a="list.html?brandId="+t,o=s?s:"",r=e+"/"+o+"brandcate-"+t+".html"+i,n=SEMURL?r:a;return n};var e,i=document.documentElement,a={init:function(){var s=new lib.httpurl(location.href),a=s.params,o=a.title?decodeURIComponent(a.title):"商品详情";return e=i.getBoundingClientRect().width,this.productId=a.productId,this.brandId=a.brandId||null,this.isBuy=!1,this.nosuxing=!1,lib.h5log.log(["setCustomVariable",3,"productId",a.productId,"page"]),"goods_detail"==a.act?(this.renderContent(2),lib.lazyload.init(),void t("body").show()):(a.attr&&a.cartNum&&(this.attr=a.attr,this.cartNum=a.cartNum,this.cartType=a.type||null,this.renderCart()),document.title=o,this.topbar=new ctrl.topBar({isIndex:!1,title:o,topHome:!0}),this.render(),this.getTurnOff(),this.addEvent(),lib.lazyload.init({loadHidden:!1}),void new lib.goTop({position:{bottom:65}}))},checkUrl:function(){if(SEMURL&&location.href.indexOf("/goods-")<0){var t=this;if(t.urlAjax)return;t.urlAjax=!0,lib.api.get({api:{c:"alias",a:""},data:{productId:this.productId,brandId:this.brandId},success:function(s){var e="http://"+location.host,i=t.brandId?"?brandId="+t.brandId:"";location.href=e+"/"+s.alias+"goods-"+t.productId+".html"+i},error:function(t){console.log(t)},complete:function(){t.urlAjax=!1}})}},addEvent:function(){var s=!1;t(".middle-top li").on("click",function(){"2"==t(this).find("span").attr("po")?(t(".pro-love").show(),t(".pro-detail").hide(),s||lib.lazyload.trigger(),s=!0):(t(".pro-detail").show(),t(".pro-love").hide()),t(".middle-top span").removeClass("hover"),t(this).find("span").addClass("hover")})},getTurnOff:function(){var s=this;t.getJSON("http://act.quxiu.me/data/switch.json",function(t){s.turnOff=t.turnoff})},renderLove:function(){try{var s=this,e=t("#love-items"),i=t("#tpl-loveitems").html();e.append(_.template(i)({itemList:s.data.brand.data,brandId:s.brandId,alias:s.data.alias?s.data.alias:""})),lib.lazyload.trigger()}catch(a){}},render:function(){var s=this;s.isAjax||(s.isAjax=!0,lib.api.get({api:{c:"deal",a:"detail"},data:{productId:this.productId,brandId:this.brandId},success:function(e){t("body").show(),e.products.is_sea_label&&(s.cartType=e.products.is_sea_label),s.data=e,s.renderContent(1),s.renderSlide(e.products.images),s.renderItems([e]);var i=e.products.comment_lists?e.products.comment_lists:null;null!=i&&s.renderMask(i),s.renderAct(e),s.renderTime(e);try{e.products.brief.length<1&&t(".recom").hide()}catch(a){console.log("no brief")}if(e.brand){e.brand.data?s.renderLove():t(".middle-top").remove(),t(".middle-top").fixedsticky();var o=window.navigator.userAgent.toLowerCase();o.match(/MobileVecn/i)&&t(".middle-top").css("top","0px"),s.renderBrands()}else t(".pro-love").remove(),t(".middle-top").remove(),t("#brands").remove();if(parseInt(e.products.end_time)<parseInt(Date.parse(new Date)/1e3)||parseInt(e.products.begin_time)>parseInt(Date.parse(new Date)/1e3)||e.products.is_stock<=0)return t(".main").prepend('<p class="no-item">宝贝已被抢光</p>'),t("#buy-now").html(" 加入购物车"),t("#buy-now").addClass("pro-nobuy"),t("#buy").html(" 立即购买"),void t("#buy").addClass("pro-nobuy");if(s.turnOff)t("#buy").hide(),t("#buy-now").removeClass("pro-buy").addClass("pro-buy-red"),s.renderSku(e);else if(e.products)if(1==e.products.is_sea_label)t("#buy").hide(),t("#buy-now").removeClass("pro-buy").addClass("pro-buy-red"),1==e.products.suxing[0].xxsx.length?(t(".pro-buy").removeClass("sku-trigger"),s.cartNum=1,t("#sku-size").val(e.products.suxing[0].xxsx[0].id),s.attr=t("#sku-size").val(),t("#buy-now").on("click",function(){t(this).hasClass("pro-nobuy")||s.renderCart()})):s.renderSku(e);else if(e.products.suxing&&e.products.suxing[0])if(1==e.products.suxing[0].xxsx.length)t(".pro-buy").removeClass("sku-trigger"),s.cartNum=1,t("#sku-size").val(e.products.suxing[0].xxsx[0].id),s.attr=t("#sku-size").val(),t("#buy").on("click",function(){s.isBuy=!0,t(this).hasClass("pro-nobuy")||s.renderCart()}),t("#buy-now").on("click",function(){t(this).hasClass("pro-nobuy")||s.renderCart()});else{var r=!0;r=t("#buy").hasClass("pro-nobuy")?!1:!0,r=t("#buy-now").hasClass("pro-nobuy")?!1:!0,t("#buy").on("click",function(){s.isBuy=!0}),t("#buy-now").on("click",function(){s.isBuy=!1}),r&&s.renderSku(e)}else e.products.suxing||(t(".pro-buy").removeClass("sku-trigger"),s.cartNum=1,s.nosuxing=!0,t("#buy").on("click",function(){s.isBuy=!0,t(this).hasClass("pro-nobuy")||s.renderCart()}),t("#buy-now").on("click",function(){t(this).hasClass("pro-nobuy")||s.renderCart()}));lib.lazyload.trigger()},error:function(s){t("body").show(),t(".container").css("height","100%"),t(".container").css("margin-top","0px"),t(".container").css("padding-top","40px"),t(".container").html("<p class='no-product no-img'></p><p class='no-product'><span>该商品不存在</span><br /><span class='backIndex'><a href=\"index.html\">回到首页</a></span></p>"),console.log(s)},complete:function(){s.isAjax=!1}}))},renderBrands:function(){var s=this,e=t("#brands"),i=t("#tpl-brands").html();e.append(_.template(i)({itemList:[s.data.brand],alias:s.data.alias?s.data.alias:""}))},renderTime:function(s){if(parseInt(s.products.end_time)>parseInt(Date.parse(new Date)/1e3)){{lib.countdown({endDate:"+"+(parseInt(s.products.end_time)-parseInt(Date.parse(new Date)/1e3)).toString(),stringFormatter:"d天 hh小时mm分ss秒",onUpdate:function(s){t(".timeover").html("还剩"+s.stringValue)},onEnd:function(){console.log("cd2 ended")}}).start()}t(".timeover").show()}else t(".timeover").remove()},renderAct:function(s){if("1"==s.products.free_ship?(t(".payoffall").show(),t("#by").append('<p><span class="by">包邮</span> <span class="active-desc">该商品包邮</span></p>')):t("#by").hide(),"undefined"!=typeof s.promotions){var e=s.promotions,i="",a="",o="";if(e.length>0){t(".payoffall").show();for(var r=0;r<e.length;r++)"discount"==e[r].type&&(i=e[r].title+"，"),"gift"==e[r].type&&(a+=e[r].title+"，",e[r].goods_gift&&(o+="<ul>",t(e[r].goods_gift).each(function(){o+='<li><p><img width="50" src="'+this.gift_minpic+'" /><a href="detail.html?productId='+this.goods_id+'">'+this.goods_name+"</a></p> </li>"}),o+="</ul>"));i=i.substring(0,i.length-1),a=a.substring(0,a.length-1),""!=i?t("#mj").append('<p><span class="mj">满减</span> <span class="active-desc">'+i+"</span></p>"):t("#mj").hide(),""!=a?t("#mz").append('<p><span class="mz">满赠</span> <span class="active-desc">'+a+"</span></p>"):t("#mz").hide(),o?t("#gift").html(o):t("#gift").hide()}else"0"==s.products.free_ship&&t(".payoffall").hide()}else"0"==s.products.free_ship&&t(".payoffall").remove()},renderContent:function(s){var e=this;e.con_isAjax||(e.con_isAjax=!0,lib.api.get({api:{c:"deal",a:"detail_content"},data:{productId:this.productId},success:function(i){var a=i.data.description?i.data.description:"";a=a.replace(/src=".\/public/g,'src="http://img.ve.cn/public'),a=a.replace(/http:\/\/img.ve.chttp/g,"http:"),a=a.replace(/src/g,'class="lazy" src="http://h5.quxiu.me/assets/img/cart_img_black_640x253.png" dataimg'),1==s?e.data&&e.data.brand&&!e.data.brand.data?(t(".pro-detail").prepend("<h1>图文详情</h1>"+a),t(".pro-detail").css("margin-top","5px")):t(".pro-detail").prepend(a):2==s&&t("body").html('<div class="c-detail">'+a+"</div>"),setTimeout(function(){lib.lazyload.trigger()},400)},error:function(){2==s&&t("body").html("暂时没有描述"),e.renderError("network")},complete:function(){e.con_isAjax=!1}}))},renderSku:function(s){var e=this;this.evaDialog=new lib.Dialog({boxClass:"#sku-dialog",triggerClass:".sku-trigger",onShow:function(){setTimeout(function(){t(".sku-dialog-box").css("-webkit-transform","translateY(0%)")},100),t(".topbar").hide(),t("body").css("padding-top","0px"),t(".ve-gotop").hide()},onHide:function(){t(".topbar").show(),t("body").css("padding-top","40px"),t(".ve-gotop").show()}}),t(".sku-cancel").on("click",function(){t(".sku-dialog-box").css("-webkit-transform","translateY(100%)"),setTimeout(function(){t("#sku-dialog").hide(),t(".topbar").show(),t("body").css("padding-top","40px")},300)});var i=t("#dia-sku-top"),a=t("#tpl-dia-sku-top").html();i.prepend(_.template(a)({itemList:[s.products]}));var o=0==parseInt(s.products.user_min_bought)?1:s.products.user_min_bought,r=0==parseInt(s.products.user_max_bought)?999:s.products.user_max_bought;if(e.number=new ctrl.number({el:"#J_Num1",step:1,quantity:o,min:o,max:r}),null!=s.products.suxing){var n=t("#dia-sku-size"),d=t("#tpl-dia-sku-size").html();n.html(_.template(d)({itemList:s.products.suxing[0].xxsx})),s.products.suxing[0].xxsx.length>=1&&(t(".sku-size span:eq(0)").attr("select","true"),t(".sku-size span:eq(0)").css("border","1px solid #ff3862"),t(".sku-size span:eq(0)").css("color","#ff3862"),t("#sku-size").val(s.products.suxing[0].xxsx[0].id))}t(".sku-size span").click(function(){"false"==t(this).attr("select")?(t("#sku-size").val(t(this).attr("barcode")),t(".sku-size span").attr("select","false"),t(".sku-size span").css("border","1px solid #333333"),t(".sku-size span").css("color","#333333"),t(this).attr("select","true"),t(this).css("border","1px solid #ff3862"),t(this).css("color","#ff3862"),t("#sku-bigpri").html(parseFloat(t(this).attr("current_price")))):(t("#sku-size").val(""),t(".sku-size span").css("border","1px solid #333333"),t(".sku-size span").css("color","#333333"),t(".sku-size span").attr("select","false"))}),t(".pro-sku-foot span").click(function(){e.renderCart()})},renderMask:function(t){var s=this;this.evaDialog=new lib.Dialog({boxClass:"#dialog",triggerClass:".evaimg-trigger",hideClass:"#sliderDiv",onShow:function(){s.maskSlider(this.obj,t)}})},maskSlider:function(s,i){if(this.maskslider=null,!this.maskslider){t(".slider-box2").html('<div class="slider-outer"><div id="slides2" class="slider-wrap"> </div></div><div class="slider-status2"></div>'),t(".dialog-box").css("width",.9*e+"px");var a=t("#slides2"),o=t("#tpl-masklides").html();a.html(_.template(o)({itemList:i[t(s).attr("itemid")].imgurl,w:.9*e})),this.maskslider=new lib.Slider(".slider-box2",{trigger:".slider-status2"})}this.maskslider.slideTo(t(s).attr("i")),lib.lazyload.trigger()},renderItems:function(s){var e=t("#items"),i=t("#tpl-item").html();e.append(_.template(i)({itemList:s}));var a=t("#recom-content"),o=t("#tpl-recom-content").html();a.html(_.template(o)({itemList:s}))},renderSlide:function(s){var i=t("#slides"),a=t("#tpl-slides").html();i.append(_.template(a)({itemList:s,w:e}));new Swiper(".swiper-container",{pagination:".swiper-pagination",slidesPerView:"auto",centeredSlides:!0,paginationClickable:!0,spaceBetween:30});this.data&&""!=this.data.supplier&&t(".slider-box").append(this.data.supplier.indexOf("保税")>=0?'<div class="supplier">'+this.data.supplier+"</div>":'<div class="supplier2">'+this.data.supplier+"</div>")},renderCart:function(){lib.login.isLogin()||lib.storage.set("accessToken","");var s,e;if(this.nosuxing)s="",e=this.cartNum;else if(this.attr&&this.cartNum)s=this.attr,e=this.cartNum;else{if(null!=this.data.products.attr&&""==t("#sku-size").val())return void lib.notification.alert("请选择尺寸",function(){this.hide()}).show();s=t("#sku-size").val(),e=t(this.number.$inputNum).attr("valueAsNumber")}var i=this;if(!i.skusure_isAjax){i.goodsNumber=this.cartNum?this.cartNum:t(this.number.$inputNum).attr("valueAsNumber"),i.skusure_isAjax=!0;var a={attr:s,user_min_bought:null,free_ship:null,user_max_bought:null,img:null,imgurl:null,isSelect:!0,suxing:null,itemid:null,nofree_ship_info:null,sourceId:null,source:null,settle:null,promotions:null,product_name:null,productid:this.productId,price:0,origin_price:0,position:0,num:e,is_stock:0,gift:!1,decrease:!1};lib.api.get(this.isBuy?{api:{c:"shoping",a:"addtocart"},data:{json:"["+JSON.stringify(a)+"]",buy_now:1,accessToken:lib.storage.get("accessToken")},success:function(t){lib.h5log.log(["setCustomVariable",3,"productId",i.productId,"page"],["setCustomVariable",4,"goodsNumber",i.goodsNumber,"page"]),null!=s&&e&&(lib.login.isLogin()?location.href=0==i.data.products.is_sea_label?"order-confirm.html":"order-confirm.html?proType=1":0==i.data.products.is_sea_label?setTimeout(function(){location.href="direct-order-confirm.html?cartId="+t.cart_id},50):setTimeout(function(){location.href="direct-order-confirm.html?proType=1&cartId="+t.cart_id},50))},error:function(t){if(t&&""!=t.desc){var s=t.desc;alert(s)}else s="服务器开小差啦"},complete:function(){i.skusure_isAjax=!1}}:{api:{c:"shoping",a:"addtocart"},data:{json:"["+JSON.stringify(a)+"]",accessToken:lib.storage.get("accessToken"),buy_now:0},success:function(){if(lib.h5log.log(["setCustomVariable",3,"productId",i.productId,"page"],["setCustomVariable",4,"goodsNumber",i.goodsNumber,"page"]),a.attr||a.num){t(".sku-dialog-box").css("-webkit-transform","translateY(100%)"),setTimeout(function(){t("#sku-dialog").css("display","none")},400),t(".topbar").show(),t("body").css("padding-top","40px");var s=lib.notification.confirm("已成功加入购物车，是否去结算？","",function(t,s){window.location=s?0==i.data.products.is_sea_label?"cart.html":"cart.html?type=2":i.data.brand&&i.data.alias?Global.formatLink(i.data.brand.brandId,i.data.alias):"index.html",this.hide()},{okText:"去结算",noText:"继续逛"});s.show()}},error:function(t){if(t&&""!=t.desc)var s=t.desc;else s="服务器开小差啦";lib.notification.alert(s,function(){this.hide()},{okText:"确定"}).show()},complete:function(){i.skusure_isAjax=!1}})}},renderError:function(t){switch(t){case"param":this.showTip("参数请求错误");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，数据为空")}},showTip:function(s){var e=t("#info-tip");e.html(s).show()},hideTip:function(s){var e=t("#info-tip");s?(e.html("加载已完毕").show(),setTimeout(function(){e.hide()},5e3)):e.hide()}};t(function(){a.init()})}(Zepto,window.Global||(window.Global={}));