!function(e,t){function i(e,t){if(s[e])return void t(s[e]);var i=[{id:"",name:"我不清楚",pid:e}];lib.api.get({api:{c:"user",a:"get_area"},needLogin:!1,data:{area_id:e},success:function(i){i.data&&t(i.data),console.log(i),s[e]=i.data},error:function(a){console.error(a),t(i),s[e]=i}})}function a(e){var t={},a={},n=e.id||1,o=e.deep||4,s=e.onReady,c={4:"province",3:"city",2:"area",1:"street"};i(n,function(e){var n=c[o],l=null;a[n]=[],e.forEach(function(e,t){!r.content.address_detail[n]||-1==e.name.indexOf(r.content.address_detail[n])&&-1==r.content.address_detail[n].indexOf(e.name)||(l=t);var i={key:e.name,value:e.id,selected:t===(l||0)};a[n].push(i)}),t[n]=a[n][l||0],o--,1>o?s&&s(a):i(t[n].value,arguments.callee)})}function n(e,t){t=t||{};var i=ctrl.selectmenu;o=new i({confirmText:t.confirmText||"确定",title:t.title||"",cancelText:t.opts||"取消",trigger:t.trigger,verifyMe:function(){return!c}}),o.viewModel=e,o.addEventListener("confirm",function(){console.log(c),c||t.onConfirm(this.selectedValue)}),o.addEventListener("select",function(e){var t=this.selectedValue["val-"+e],i=this;console.log(c),c=!0,"province"==e?a({id:t,deep:3,onReady:function(e){i.linkage("city",e.city),i.linkage("area",e.area),i.linkage("street",e.street)}}):"city"==e?a({id:t,deep:2,onReady:function(e){i.linkage("area",e.area),i.linkage("street",e.street)}}):"area"==e?a({id:t,deep:1,onReady:function(e){i.linkage("street",e.street)}}):"street"==e&&(c=!1)}),document.body.appendChild(o.root)}var o,r,s={},c=!1;t.selectAddress={init:function(t){e.ajax({type:"GET",url:"http://api.map.baidu.com/location/ip?ak=7LKIOX88UcaHWrMDzN7coBub&coor=bd09ll&qt=loc&callback=?",data:{name:"Zepto",type:"JSONP"},success:function(e){r=e,a({onReady:function(e){n(e,t)}})},error:function(){console.log("Ajax error!"),a({onReady:function(e){n(e,t)}},{content:{address_detail:{province:"浙江省",city:"杭州市"}}})}})}}}(Zepto,window.app||(window.app={})),function(e){Global.formatImgSrc=function(e){if(!e)return"http://h5.quxiu.me/assets/img/cart_img_black_640x253.png";var t=e.match(/^http:\/\/img\.ve\.cnttp(.+)_3\.jpg/);return t?"http"+t[1]+".jpg":e};var t={init:function(){var t=new lib.httpurl(location.href),i=t.params,a=i.title?decodeURIComponent(i.title):"确认订单";document.title=a,new ctrl.topBar({isIndex:!1,title:a}),this.proType=parseInt(i.proType)||0,this.cartId=parseInt(i.cartId)||0,this.code=i.code||0,this.id=i.id||0,this.value=i.value||0,this.duringPay=!1,this.proType&&e(".note-container a").attr("href","login.html?redirectUrl=order-confirm.html%3FproType%3D1"),lib.lazyload.init(),this.addEvents();var n=window.navigator.userAgent.toLowerCase();n.match(/MicroMessenger/i)?e(".weixinpay").css("display","block"):e(".weixinpay").hide(),new lib.goTop,this.render(),this.brandId=i.brandId||0,this.categoryId=i.categoryId||0},addEvents:function(){var t=this;e("#get-code").on("click",function(){t.getCode()}),e(".payinfo").on("click",function(){if(t.verify()){var i=20,a=null;"alipay"==e(this).attr("paytype")?i=20:"wxpay"==e(this).attr("paytype")&&(i=25,a="http://pay.api.ve.cn"),t.duringPay||(t.duringPay=!0,t.paragram={source:"h5",in_app:0,order_type:t.proType-0+1},t.paragram.pay_type=i,t.name&&(t.paragram.name=t.name),t.phone&&(t.paragram.phone=t.phone),t.code&&(t.paragram.verify_code=t.code),t.province&&(t.paragram.provice=t.province),t.city&&(t.paragram.city=t.city),t.area&&(t.paragram.area=t.area),t.street&&(t.paragram.town=t.street),t.addressDet&&(t.paragram.address=t.addressDet),t.cartId&&(t.paragram.ids=t.cartId),lib.api.get({api:{c:"FreeOrder",a:"add_User_Order"},needLogin:lib.login.isLogin(),apiUrl:a,data:t.paragram,success:function(e){console.log(e),lib.login.login(e,e.html_url)},error:function(e){var t=lib.notification.alert(e.desc,function(){this.hide()});t.show()},complete:function(){t.duringPay=!1}}))}})},getCode:function(){var e=this;1!=e.isAjaxGetcode&&this.verifyMobile("tel")&&(e.isAjaxGetcode=!0,lib.api.get({api:{c:"sms",a:"sendMsg"},data:{mobile:this.phone,status:"free_user"},success:function(t){console.log(t),lib.notification.simple("发送成功","",1e3),e.timerClock("#get-code")},error:function(e){console.log(e),alert(e&&e.desc?e.desc:"请求验证码失败")},complete:function(){setTimeout(function(){e.isAjaxGetcode=!1},1e3)}}))},timerClock:function(t){var i=this,a=60;i.verifyFlag=1,e(t).addClass("getcode-icon").html("剩余 "+a+" 秒"),e(t).off();var n=setInterval(function(){1>=a?(clearInterval(n),i.verifyFlag=0,e(t).removeClass("getcode-icon").html("获取验证码"),e(t).on("click",function(){i.getCode()})):(a--,e(t).html("剩余 "+a+" 秒"))},1e3)},render:function(){var t=this;app.selectAddress.init({confirmText:"",title:"",cancelText:"",trigger:document.getElementById("provice"),onConfirm:function(i){t.pro=i,console.log(i),e("#provice").css("color","#333"),t.province=i["val-province"],t.city=i["val-city"],t.area=i["val-area"],t.street=i["val-street"],e("#provice").html((i["key-province"]||"")+(i["key-city"]||"")+(i["key-area"]||"")+i["key-street"]||"")}}),t.isAjax||(t.isAjax=!0,lib.api.get({api:{c:"shoping",a:"get_User_Cart"},needLogin:lib.login.isLogin(),data:{accessToken:"",cart_ids:t.cartId||""},success:function(i){if(console.log(i),t.proType&&!i.is_sea_order){var a=lib.notification.alert(i.sea_limit_message,function(){this.hide(),window.location.href="cart.html?type=2"},{useTap:!0});a.show()}var n=t.proType?i.sea_products:i.products;n&&n[0]?(e(".container").show(),e(".loading").hide(),t.renderItems(i),t.renderSum(i)):window.location.href="order-list.html#status=1"},error:function(e){var t=lib.notification.alert(e.desc,function(){this.hide(),window.location.href="order-list.html"},{useTap:!0});t.show()},complete:function(){t.isAjax=!1}}))},verifyMobile:function(){return this.phone=e("#phone").val(),this.phone?/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/.test(this.phone)?!0:(lib.notification.simple("手机格式错误","",1e3),!1):(lib.notification.simple("请先填写手机号码","",1e3),!1)},verify:function(){return this.name=e("#username").val(),this.phone=e("#phone").val(),this.code=e("#code").val(),this.addressDet=e("#addressDet").val(),this.name=this.name.trim(),this.addressDet=this.addressDet.trim(),0==this.phone.length?(lib.notification.simple("手机号码不能为空","",1e3),!1):0==this.code.length?(lib.notification.simple("验证码不能为空","",1e3),!1):0==this.name.length?(lib.notification.simple("收货人不能为空","",1e3),!1):this.name.length>12?(lib.notification.simple("用户名长度不能超过12个字符","",1e3),!1):/^(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/.test(this.phone)?null==this.pro||""==this.pro?(lib.notification.simple("省市区不能为空","",1e3),!1):0==this.addressDet.length?(lib.notification.simple("详细地址不能为空","",1e3),!1):!0:(lib.notification.simple("手机格式错误","",1e3),!1)},checkNeedScroll:function(){return!this.is_have},renderAddress:function(t){var i=e("#address"),a=this,n=e("#tpl-address").html();i.prepend(_.template(n)({addressData:t,proType:a.proType,isLogin:lib.login.isLogin()}))},renderItems:function(t){var i=this.proType?t.sea_products:t.products;for(var a in i){var n=0;for(var o in i[a].orders)n+=i[a].orders[o].price*i[a].orders[o].num;i[a].sum=n}var r=this.proType?t.sea_total_price:t.total_price,s=e("#orders"),c=e("#tpl-goods").html();s.append(_.template(c)({products:i,proType:this.proType,total_price:r})),lib.lazyload.trigger()},renderSum:function(t){var i=e(".pay-container"),a=e("#tpl-pay").html();i.prepend(_.template(a)({data:t,value:this.value,proType:this.proType}))},renderError:function(e){switch(e){case"param":this.showTip("缺少必要参数");break;case"network":this.showTip("服务器开小差啦");break;case"empty":this.showTip("当前条件，列表为空")}},showTip:function(t){var i=e(".info-tip");i.html(t).show()}};e(function(){t.init()})}(Zepto,window.Global||(window.Global={}));