!function(e,t){var n={open:function(e,t){if(e){var n=e.firstChild;e.style.opacity=1,e.style.visibility="visible",setTimeout(function(){n.style.webkitTransform="translateY(0)",t&&t()},0)}},close:function(e,t){if(e){var n=e.firstChild;n.style.webkitTransform="translateY(100%)",setTimeout(function(){e.style.opacity=0,e.style.visibility="hidden",t&&t()},200)}}},i=0,r={container:"ctrl-selectmenu",innerBox:"ctrl-selectmenu-picker",header:"ctrl-selectmenu-header",confirm:"ctrl-selectmenu-btn-confirm",cancel:"ctrl-selectmenu-btn-cancel",col:"ctrl-selectmenu-col",option:"ctrl-selectmenu-option",wrapper:"ctrl-selectmenu-wrapper"},s=function(e,t){var s=this,l=Date.now()+"-"+ ++i,c=document.createDocumentFragment();1!==arguments.length||arguments[0]instanceof HTMLElement||(t=arguments[0],e=null),e||(e=document.createElement("div")),c.appendChild(e),e.setAttribute("data-ctrl-name","selectmenu"),e.setAttribute("data-ctrl-id",l),e.className=r.container,this.options=t;var o=t.title||"";Object.defineProperty(this,"title",{get:function(){return o},set:function(t){if(!t)throw new Error("Non expected value");o=t,e.querySelector(".tip").innerHTML=t}});var a=t.confirmText||"确定";Object.defineProperty(this,"confirmText",{get:function(){return a},set:function(t){if(!t)throw new Error("Non expected value");a=t,e.querySelector("."+r.confirm).innerHTML=t}});var h=t.cancelText||"取消";Object.defineProperty(this,"cancelText",{get:function(){return h},set:function(t){if(!t)throw new Error("Non expected value");h=t,e.querySelector("."+r.cancel).innerHTML=t}});var d;Object.defineProperty(this,"viewModel",{get:function(){return d},set:function(e){if(!e)throw new Error("Non expected value");d=e,s.syncViewModel()}}),this.syncViewModel=function(){var e=this;this.render(),setTimeout(function(){e.addEvents()},100)},this._events={},this.addEventListener=function(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},this.removeEventListener=function(e,t){if(this._events[e]){var n=this._events[e].indexOf(t);n>-1&&this._events[e].splice(n,1)}},this.execEvent=function(e){if(this._events[e]){var t=0,n=this._events[e].length;if(n)for(;n>t;t++)this._events[e][t].apply(this,[].slice.call(arguments,1))}},this.remove=function(){e.parentNode&&e.parentNode.removeChild(e)},this.element=e,this.root=c;var u={},v={},f={};this.render=function(){var e=d,t=['<div class="'+r.header+'">','<a href="javascript:void(0);" class="'+r.cancel+'">'+h+"</a>",'<span class="tip">'+o+"</span>",'<a href="javascript:void(0);" class="'+r.confirm+'">'+a+"</a>","</div>"].join(""),n='<div class="'+r.wrapper+'"></div>';this.element.innerHTML='<div class="'+r.innerBox+'">'+t+n+"</div>";for(var i in e)this.renderColumn(i,e[i]);this.refresh()},this.selectedIndex={},this.renderColumn=function(e,t){var n=this;if(!Array.isArray(t))throw"select项数据列表必须是数组";var i=[];n.selectedIndex[e]=0,t.forEach(function(t,s){t.selected&&(n.selectedIndex[e]=s),i.push('<div class="'+r.option+'" data-value="'+t.value+'">'+t.key+"</div>")});var s=i.join(""),l=n.element.querySelector("."+r.wrapper),c=l.querySelector("[data-type="+e+"]");if(c)c.firstChild.innerHTML=s;else{var o='<div class="scroller">'+s+"</div>",a=document.createElement("div");a.className=r.col,a.setAttribute("data-type",e),a.innerHTML=o,l.appendChild(a)}},this.setScroll=function(){var e=this,t=[].slice.call(this.element.querySelectorAll("."+r.col));t.forEach(function(t){var n=t.querySelector(".scroller"),i=lib.scroll({scrollElement:n,inertia:"slow"}).init();n.addEventListener("click",function(e){var t=e.target;0===t.className.indexOf(r.option)&&i.scrollToElement(t,!0)},!1),i.addScrollendHandler(function(){e.scrollEndHandler(i,t)});var s=t.getAttribute("data-type");e.scrollToNthChild(i,e.selectedIndex[s]),i.handler=!0,u[s]=i}),this.selects=t,this.scrolls=u},this.currentColName="",this.scrollEndHandler=function(e,t){if(!e.handler)return void(e.handler=!0);var n=e.getScrollTop(),i=Math.round(n/this.height);e.handler=!1,this.scrollToNthChild(e,i,!1);var r=t.getAttribute("data-type");this.currentColName=r,this.setSelectedStatus(r,Math.abs(i)),this.execEvent("select",r)},this.setSelectedStatus=function(e,t){var n=this.scrolls[e].element,i=n.querySelectorAll("."+r.option);v[e]=n.querySelector(".current"),v[e]&&(v[e].className=r.option),v[e]=i[t],v[e].className=r.option+" current",f["val-"+e]=v[e].getAttribute("data-value"),f["key-"+e]=v[e].innerHTML,this.selectedValue=f,this.selectedIndex[e]=t},this.resetScrollPos=function(){var e=this;this.selects&&this.selects.forEach(function(t){var n=t.getAttribute("data-type"),i=e.scrolls[n];e.scrollToNthChild(i,e.selectedIndex[n])})},this.scrollToNthChild=function(e,t,n){var i=e.element,r=i.querySelector(":nth-child("+(1+t)+")"),s="undefined"!=typeof n?n:!0;e.scrollToElement(r,s)};var m=!1,p=!1;this.addEvents=function(){function e(){n.refresh()}var t=this.options,n=this;if(!p){var i;if(window.addEventListener("resize",function(){clearTimeout(i),i=setTimeout(e,310)},!1),t.trigger){var s=t.trigger.length>1?[].slice.call(t.trigger):[t.trigger];s.forEach(function(e){e.addEventListener("click",function(){n.trigger=e,n.show()})})}p=!0}this.element.querySelector("."+r.confirm).addEventListener("click",function(){if(t.verifyMe){if(!t.verifyMe(n.selectedValue))return;n.hide()}else n.hide();n.execEvent("confirm",n.trigger)},!1),this.element.querySelector("."+r.cancel).addEventListener("click",function(){n.execEvent("cancel",n.trigger),n.hide()},!1)},this.show=function(){var e=this;this.execEvent("beforeShow",e.trigger),n.open(this.element),setTimeout(function(){m||(e.setScroll(),m=!0)},100),this.execEvent("show")},this.hide=function(){n.close(this.element),this.execEvent("hide")},this.refresh=function(){var e=this,t=setInterval(function(){var n="."+r.option,i=document.querySelector(n);i&&i.clientHeight&&(e.height=i.clientHeight,e.resetScrollPos(),clearInterval(t),t=null)},100)},this.linkage=function(e,t){this.viewModel[e]=t,this.renderColumn(e,t);var n=this.scrolls[e],i=this.selectedIndex[e];n.refresh(),this.scrollToNthChild(n,i)},this.scrollToIndex=function(e,t){var n=this.scrolls[e];this.scrollToNthChild(n,t),this.setSelectedStatus(e,t)}};t.selectmenu=s}(window,window.ctrl||(window.ctrl={}));